<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="common/css/sf.css" rel="stylesheet" type="text/css"/>
<title>ImpParser: Lexing and Parsing in Coq</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/lf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 1: Logical Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">ImpParser<span class="subtitle">Lexing and Parsing in Coq</span></h1>


<div class="doc">

<div class="paragraph"> </div>

 The development of the Imp language in <span class="inlinecode"><span class="id" title="variable">Imp.v</span></span> completely ignores
    issues of concrete syntax &mdash; how an ascii string that a programmer
    might write gets translated into abstract syntax trees defined by
    the datatypes <span class="inlinecode"><span class="id" title="variable">aexp</span></span>, <span class="inlinecode"><span class="id" title="variable">bexp</span></span>, and <span class="inlinecode"><span class="id" title="variable">com</span></span>.  In this chapter, we
    illustrate how the rest of the story can be filled in by building
    a simple lexical analyzer and parser using Coq's functional
    programming facilities. 
</div>

<div class="doc">
<a name="lab413"></a><h1 class="section">Internals</h1>

</div>
<div class="code code-space">

<br/>
</div>

<div class="doc">
<a name="lab414"></a><h2 class="section">Lexical Analysis</h2>

</div>
<div class="code code-space">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">isWhite</span> (<span class="id" title="variable">c</span> : <span class="id" title="variable">ascii</span>) : <span class="id" title="variable">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="variable">n</span> := <span class="id" title="variable">nat_of_ascii</span> <span class="id" title="variable">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="variable">orb</span> (<span class="id" title="variable">orb</span> (<span class="id" title="variable">n</span> =? 32)   <span class="comment">(*&nbsp;space&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">n</span> =? 9))   <span class="comment">(*&nbsp;tab&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">orb</span> (<span class="id" title="variable">n</span> =? 10)   <span class="comment">(*&nbsp;linefeed&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">n</span> =? 13)). <span class="comment">(*&nbsp;Carriage&nbsp;return.&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> "x '&lt;=?' y" := (<span class="id" title="variable">x</span> &lt;=? <span class="id" title="variable">y</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 70, <span class="id" title="variable">no</span> <span class="id" title="variable">associativity</span>) : <span class="id" title="variable">nat_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">isLowerAlpha</span> (<span class="id" title="variable">c</span> : <span class="id" title="variable">ascii</span>) : <span class="id" title="variable">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="variable">n</span> := <span class="id" title="variable">nat_of_ascii</span> <span class="id" title="variable">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">andb</span> (97 &lt;=? <span class="id" title="variable">n</span>) (<span class="id" title="variable">n</span> &lt;=? 122).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">isAlpha</span> (<span class="id" title="variable">c</span> : <span class="id" title="variable">ascii</span>) : <span class="id" title="variable">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="variable">n</span> := <span class="id" title="variable">nat_of_ascii</span> <span class="id" title="variable">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">orb</span> (<span class="id" title="variable">andb</span> (65 &lt;=? <span class="id" title="variable">n</span>) (<span class="id" title="variable">n</span> &lt;=? 90))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">andb</span> (97 &lt;=? <span class="id" title="variable">n</span>) (<span class="id" title="variable">n</span> &lt;=? 122)).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">isDigit</span> (<span class="id" title="variable">c</span> : <span class="id" title="variable">ascii</span>) : <span class="id" title="variable">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="variable">n</span> := <span class="id" title="variable">nat_of_ascii</span> <span class="id" title="variable">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">andb</span> (48 &lt;=? <span class="id" title="variable">n</span>) (<span class="id" title="variable">n</span> &lt;=? 57).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">chartype</span> := <span class="id" title="variable">white</span> | <span class="id" title="variable">alpha</span> | <span class="id" title="variable">digit</span> | <span class="id" title="variable">other</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">classifyChar</span> (<span class="id" title="variable">c</span> : <span class="id" title="variable">ascii</span>) : <span class="id" title="variable">chartype</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="variable">isWhite</span> <span class="id" title="variable">c</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">white</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="variable">isAlpha</span> <span class="id" title="variable">c</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">alpha</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="variable">isDigit</span> <span class="id" title="variable">c</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">digit</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">other</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">list_of_string</span> (<span class="id" title="variable">s</span> : <span class="id" title="variable">string</span>) : <span class="id" title="variable">list</span> <span class="id" title="variable">ascii</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">s</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">EmptyString</span> ⇒ []<br/>
&nbsp;&nbsp;| <span class="id" title="variable">String</span> <span class="id" title="variable">c</span> <span class="id" title="variable">s</span> ⇒ <span class="id" title="variable">c</span> :: (<span class="id" title="variable">list_of_string</span> <span class="id" title="variable">s</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">string_of_list</span> (<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">ascii</span>) : <span class="id" title="variable">string</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="variable">fold_right</span> <span class="id" title="variable">String</span> <span class="id" title="variable">EmptyString</span> <span class="id" title="variable">xs</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">token</span> := <span class="id" title="variable">string</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">tokenize_helper</span> (<span class="id" title="variable">cls</span> : <span class="id" title="variable">chartype</span>) (<span class="id" title="variable">acc</span> <span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">ascii</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="variable">list</span> (<span class="id" title="variable">list</span> <span class="id" title="variable">ascii</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="variable">tk</span> := <span class="id" title="keyword">match</span> <span class="id" title="variable">acc</span> <span class="id" title="keyword">with</span> [] ⇒ [] | <span class="id" title="variable">_</span>::_ ⇒ [<span class="id" title="variable">rev</span> <span class="id" title="variable">acc</span>] <span class="id" title="keyword">end</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">xs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] ⇒ <span class="id" title="variable">tk</span><br/>
&nbsp;&nbsp;| (<span class="id" title="variable">x</span>::<span class="id" title="variable">xs'</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">cls</span>, <span class="id" title="variable">classifyChar</span> <span class="id" title="variable">x</span>, <span class="id" title="variable">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">_</span>, <span class="id" title="variable">_</span>, "("      ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">tk</span> ++ ["("]::(<span class="id" title="variable">tokenize_helper</span> <span class="id" title="variable">other</span> [] <span class="id" title="variable">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">_</span>, <span class="id" title="variable">_</span>, ")"      ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">tk</span> ++ [")"]::(<span class="id" title="variable">tokenize_helper</span> <span class="id" title="variable">other</span> [] <span class="id" title="variable">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">_</span>, <span class="id" title="variable">white</span>, <span class="id" title="variable">_</span>    ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">tk</span> ++ (<span class="id" title="variable">tokenize_helper</span> <span class="id" title="variable">white</span> [] <span class="id" title="variable">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">alpha</span>,<span class="id" title="variable">alpha</span>,<span class="id" title="variable">x</span>  ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">tokenize_helper</span> <span class="id" title="variable">alpha</span> (<span class="id" title="variable">x</span>::<span class="id" title="variable">acc</span>) <span class="id" title="variable">xs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">digit</span>,<span class="id" title="variable">digit</span>,<span class="id" title="variable">x</span>  ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">tokenize_helper</span> <span class="id" title="variable">digit</span> (<span class="id" title="variable">x</span>::<span class="id" title="variable">acc</span>) <span class="id" title="variable">xs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">other</span>,<span class="id" title="variable">other</span>,<span class="id" title="variable">x</span>  ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">tokenize_helper</span> <span class="id" title="variable">other</span> (<span class="id" title="variable">x</span>::<span class="id" title="variable">acc</span>) <span class="id" title="variable">xs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">_</span>,<span class="id" title="variable">tp</span>,<span class="id" title="variable">x</span>         ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">tk</span> ++ (<span class="id" title="variable">tokenize_helper</span> <span class="id" title="variable">tp</span> [<span class="id" title="variable">x</span>] <span class="id" title="variable">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> %<span class="id" title="variable">char</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">tokenize</span> (<span class="id" title="variable">s</span> : <span class="id" title="variable">string</span>) : <span class="id" title="variable">list</span> <span class="id" title="variable">string</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="variable">map</span> <span class="id" title="variable">string_of_list</span> (<span class="id" title="variable">tokenize_helper</span> <span class="id" title="variable">white</span> [] (<span class="id" title="variable">list_of_string</span> <span class="id" title="variable">s</span>)).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">tokenize_ex<sub>1</sub></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">tokenize</span> "abc12=3  223*(3+(a+c))" %<span class="id" title="variable">string</span><br/>
&nbsp;&nbsp;= ["abc"; "12"; "="; "3"; "223";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"*"; "("; "3"; "+"; "(";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"a"; "+"; "c"; ")"; ")"]%<span class="id" title="variable">string</span>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a name="lab415"></a><h2 class="section">Parsing</h2>

<div class="paragraph"> </div>

<a name="lab416"></a><h3 class="section">Options With Errors</h3>

<div class="paragraph"> </div>

 An <span class="inlinecode"><span class="id" title="variable">option</span></span> type with error messages: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">optionE</span> (<span class="id" title="variable">X</span>:<span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="variable">SomeE</span> (<span class="id" title="variable">x</span> : <span class="id" title="variable">X</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">NoneE</span> (<span class="id" title="variable">s</span> : <span class="id" title="variable">string</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="variable">Arguments</span> <span class="id" title="variable">SomeE</span> {<span class="id" title="variable">X</span>}.<br/>
<span class="id" title="variable">Arguments</span> <span class="id" title="variable">NoneE</span> {<span class="id" title="variable">X</span>}.<br/>
</div>

<div class="doc">
Some syntactic sugar to make writing nested match-expressions on
    optionE more convenient. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Notation</span> "' p &lt;- e<sub>1</sub> ;; e<sub>2</sub>"<br/>
&nbsp;&nbsp;&nbsp;:= (<span class="id" title="keyword">match</span> <span class="id" title="variable">e<sub>1</sub></span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">SomeE</span> <span class="id" title="variable">p</span> ⇒ <span class="id" title="variable">e<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">NoneE</span> <span class="id" title="variable">err</span> ⇒ <span class="id" title="variable">NoneE</span> <span class="id" title="variable">err</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">right</span> <span class="id" title="variable">associativity</span>, <span class="id" title="variable">p</span> <span class="id" title="tactic">pattern</span>, <span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 60, <span class="id" title="variable">e<sub>1</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="variable">next</span> <span class="id" title="variable">level</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> "'TRY' ' p &lt;- e<sub>1</sub> ;; e<sub>2</sub> 'OR' e<sub>3</sub>"<br/>
&nbsp;&nbsp;&nbsp;:= (<span class="id" title="keyword">match</span> <span class="id" title="variable">e<sub>1</sub></span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">SomeE</span> <span class="id" title="variable">p</span> ⇒ <span class="id" title="variable">e<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">NoneE</span> <span class="id" title="variable">_</span> ⇒ <span class="id" title="variable">e<sub>3</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">right</span> <span class="id" title="variable">associativity</span>, <span class="id" title="variable">p</span> <span class="id" title="tactic">pattern</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 60, <span class="id" title="variable">e<sub>1</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="variable">next</span> <span class="id" title="variable">level</span>, <span class="id" title="variable">e<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="variable">next</span> <span class="id" title="variable">level</span>).<br/>
</div>

<div class="doc">
<a name="lab417"></a><h3 class="section">Generic Combinators for Building Parsers</h3>

</div>
<div class="code code-space">

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="variable">string_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">parser</span> (<span class="id" title="variable">T</span> : <span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="variable">list</span> <span class="id" title="variable">token</span> → <span class="id" title="variable">optionE</span> (<span class="id" title="variable">T</span> * <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">many_helper</span> {<span class="id" title="variable">T</span>} (<span class="id" title="variable">p</span> : <span class="id" title="variable">parser</span> <span class="id" title="variable">T</span>) <span class="id" title="variable">acc</span> <span class="id" title="variable">steps</span> <span class="id" title="variable">xs</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">steps</span>, <span class="id" title="variable">p</span> <span class="id" title="variable">xs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0, <span class="id" title="variable">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="variable">_</span>, <span class="id" title="variable">NoneE</span> <span class="id" title="variable">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> ((<span class="id" title="variable">rev</span> <span class="id" title="variable">acc</span>), <span class="id" title="variable">xs</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">S</span> <span class="id" title="variable">steps'</span>, <span class="id" title="variable">SomeE</span> (<span class="id" title="variable">t</span>, <span class="id" title="variable">xs'</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">many_helper</span> <span class="id" title="variable">p</span> (<span class="id" title="variable">t</span> :: <span class="id" title="variable">acc</span>) <span class="id" title="variable">steps'</span> <span class="id" title="variable">xs'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
A (step-indexed) parser that expects zero or more <span class="inlinecode"><span class="id" title="variable">p</span></span>s: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">many</span> {<span class="id" title="variable">T</span>} (<span class="id" title="variable">p</span> : <span class="id" title="variable">parser</span> <span class="id" title="variable">T</span>) (<span class="id" title="variable">steps</span> : <span class="id" title="variable">nat</span>) : <span class="id" title="variable">parser</span> (<span class="id" title="variable">list</span> <span class="id" title="variable">T</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="variable">many_helper</span> <span class="id" title="variable">p</span> [] <span class="id" title="variable">steps</span>.<br/>
</div>

<div class="doc">
A parser that expects a given token, followed by <span class="inlinecode"><span class="id" title="variable">p</span></span>: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Definition</span> <span class="id" title="variable">firstExpect</span> {<span class="id" title="variable">T</span>} (<span class="id" title="variable">t</span> : <span class="id" title="variable">token</span>) (<span class="id" title="variable">p</span> : <span class="id" title="variable">parser</span> <span class="id" title="variable">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="variable">parser</span> <span class="id" title="variable">T</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="variable">xs</span> ⇒ <span class="id" title="keyword">match</span> <span class="id" title="variable">xs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">x</span>::<span class="id" title="variable">xs'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="variable">string_dec</span> <span class="id" title="variable">x</span> <span class="id" title="variable">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="variable">p</span> <span class="id" title="variable">xs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="variable">NoneE</span> ("expected '" ++ <span class="id" title="variable">t</span> ++ "'.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">NoneE</span> ("expected '" ++ <span class="id" title="variable">t</span> ++ "'.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
A parser that expects a particular token: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Definition</span> <span class="id" title="variable">expect</span> (<span class="id" title="variable">t</span> : <span class="id" title="variable">token</span>) : <span class="id" title="variable">parser</span> <span class="id" title="variable">unit</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="variable">firstExpect</span> <span class="id" title="variable">t</span> (<span class="id" title="keyword">fun</span> <span class="id" title="variable">xs</span> ⇒ <span class="id" title="variable">SomeE</span> (<span class="id" title="variable">tt</span>, <span class="id" title="variable">xs</span>)).<br/>
</div>

<div class="doc">
<a name="lab418"></a><h3 class="section">A Recursive-Descent Parser for Imp</h3>

<div class="paragraph"> </div>

 Identifiers: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Definition</span> <span class="id" title="variable">parseIdentifier</span> (<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="variable">optionE</span> (<span class="id" title="variable">string</span> * <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="variable">xs</span> <span class="id" title="keyword">with</span><br/>
| [] ⇒ <span class="id" title="variable">NoneE</span> "Expected identifier"<br/>
| <span class="id" title="variable">x</span>::<span class="id" title="variable">xs'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="variable">forallb</span> <span class="id" title="variable">isLowerAlpha</span> (<span class="id" title="variable">list_of_string</span> <span class="id" title="variable">x</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">x</span>, <span class="id" title="variable">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">NoneE</span> ("Illegal identifier:'" ++ <span class="id" title="variable">x</span> ++ "'")<br/>
<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Numbers: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Definition</span> <span class="id" title="variable">parseNumber</span> (<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="variable">optionE</span> (<span class="id" title="variable">nat</span> * <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="variable">xs</span> <span class="id" title="keyword">with</span><br/>
| [] ⇒ <span class="id" title="variable">NoneE</span> "Expected number"<br/>
| <span class="id" title="variable">x</span>::<span class="id" title="variable">xs'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="variable">forallb</span> <span class="id" title="variable">isDigit</span> (<span class="id" title="variable">list_of_string</span> <span class="id" title="variable">x</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">fold_left</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="variable">n</span> <span class="id" title="variable">d</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10 * <span class="id" title="variable">n</span> + (<span class="id" title="variable">nat_of_ascii</span> <span class="id" title="variable">d</span> -<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">nat_of_ascii</span> "0"%<span class="id" title="variable">char</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">list_of_string</span> <span class="id" title="variable">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">NoneE</span> "Expected number"<br/>
<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Parse arithmetic expressions 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">parsePrimaryExp</span> (<span class="id" title="variable">steps</span>:<span class="id" title="variable">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="variable">optionE</span> (<span class="id" title="variable">aexp</span> * <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="variable">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="variable">S</span> <span class="id" title="variable">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">i</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">parseIdentifier</span> <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">AId</span> <span class="id" title="variable">i</span>, <span class="id" title="variable">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">n</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">parseNumber</span> <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">ANum</span> <span class="id" title="variable">n</span>, <span class="id" title="variable">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">e</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">firstExpect</span> "(" (<span class="id" title="variable">parseSumExp</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">u</span>, <span class="id" title="variable">rest'</span>) &lt;- <span class="id" title="variable">expect</span> ")" <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">e</span>,<span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="variable">parseProductExp</span> (<span class="id" title="variable">steps</span>:<span class="id" title="variable">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="variable">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="variable">S</span> <span class="id" title="variable">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">e</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">parsePrimaryExp</span> <span class="id" title="variable">steps'</span> <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">es</span>, <span class="id" title="variable">rest'</span>) &lt;- <span class="id" title="variable">many</span> (<span class="id" title="variable">firstExpect</span> "*" (<span class="id" title="variable">parsePrimaryExp</span> <span class="id" title="variable">steps'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">steps'</span> <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">fold_left</span> <span class="id" title="variable">AMult</span> <span class="id" title="variable">es</span> <span class="id" title="variable">e</span>, <span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="variable">parseSumExp</span> (<span class="id" title="variable">steps</span>:<span class="id" title="variable">nat</span>) (<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>)  :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="variable">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="variable">S</span> <span class="id" title="variable">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">e</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">parseProductExp</span> <span class="id" title="variable">steps'</span> <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">es</span>, <span class="id" title="variable">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">many</span> (<span class="id" title="keyword">fun</span> <span class="id" title="variable">xs</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">e</span>,<span class="id" title="variable">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">firstExpect</span> "+"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseProductExp</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> ( (<span class="id" title="variable">true</span>, <span class="id" title="variable">e</span>), <span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">e</span>, <span class="id" title="variable">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">firstExpect</span> "-"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseProductExp</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> ( (<span class="id" title="variable">false</span>, <span class="id" title="variable">e</span>), <span class="id" title="variable">rest'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">steps'</span> <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">fold_left</span> (<span class="id" title="keyword">fun</span> <span class="id" title="variable">e<sub>0</sub></span> <span class="id" title="variable">term</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">term</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="variable">true</span>,  <span class="id" title="variable">e</span>) ⇒ <span class="id" title="variable">APlus</span> <span class="id" title="variable">e<sub>0</sub></span> <span class="id" title="variable">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="variable">false</span>, <span class="id" title="variable">e</span>) ⇒ <span class="id" title="variable">AMinus</span> <span class="id" title="variable">e<sub>0</sub></span> <span class="id" title="variable">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">es</span> <span class="id" title="variable">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">parseAExp</span> := <span class="id" title="variable">parseSumExp</span>.<br/>
</div>

<div class="doc">
Parsing boolean expressions: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">parseAtomicExp</span> (<span class="id" title="variable">steps</span>:<span class="id" title="variable">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>)  :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="variable">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="variable">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="variable">S</span> <span class="id" title="variable">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">u</span>,<span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">expect</span> "true" <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">BTrue</span>,<span class="id" title="variable">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">u</span>,<span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">expect</span> "false" <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">BFalse</span>,<span class="id" title="variable">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">e</span>,<span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">firstExpect</span> "¬"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseAtomicExp</span> <span class="id" title="variable">steps'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">BNot</span> <span class="id" title="variable">e</span>, <span class="id" title="variable">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">e</span>,<span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">firstExpect</span> "("<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseConjunctionExp</span> <span class="id" title="variable">steps'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">u</span>,<span class="id" title="variable">rest'</span>) &lt;- <span class="id" title="variable">expect</span> ")" <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">e</span>, <span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">e</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">parseProductExp</span> <span class="id" title="variable">steps'</span> <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">e'</span>, <span class="id" title="variable">rest'</span>) &lt;- <span class="id" title="variable">firstExpect</span> "="<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseAExp</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">BEq</span> <span class="id" title="variable">e</span> <span class="id" title="variable">e'</span>, <span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">e'</span>, <span class="id" title="variable">rest'</span>) &lt;- <span class="id" title="variable">firstExpect</span> "≤"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseAExp</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">BLe</span> <span class="id" title="variable">e</span> <span class="id" title="variable">e'</span>, <span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">NoneE</span> "Expected '=' or '≤' after arithmetic expression"<br/>
<span class="id" title="keyword">end</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="variable">parseConjunctionExp</span> (<span class="id" title="variable">steps</span>:<span class="id" title="variable">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="variable">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="variable">S</span> <span class="id" title="variable">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">e</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">parseAtomicExp</span> <span class="id" title="variable">steps'</span> <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">es</span>, <span class="id" title="variable">rest'</span>) &lt;- <span class="id" title="variable">many</span> (<span class="id" title="variable">firstExpect</span> "&amp;&amp;"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseAtomicExp</span> <span class="id" title="variable">steps'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">steps'</span> <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">fold_left</span> <span class="id" title="variable">BAnd</span> <span class="id" title="variable">es</span> <span class="id" title="variable">e</span>, <span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">parseBExp</span> := <span class="id" title="variable">parseConjunctionExp</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Check</span> <span class="id" title="variable">parseConjunctionExp</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">testParsing</span> {<span class="id" title="variable">X</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">p</span> : <span class="id" title="variable">nat</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">list</span> <span class="id" title="variable">token</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">optionE</span> (<span class="id" title="variable">X</span> * <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">s</span> : <span class="id" title="variable">string</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="variable">t</span> := <span class="id" title="variable">tokenize</span> <span class="id" title="variable">s</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="variable">p</span> 100 <span class="id" title="variable">t</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*<br/>
Eval&nbsp;compute&nbsp;in<br/>
&nbsp;&nbsp;testParsing&nbsp;parseProductExp&nbsp;"x.y.(x.x).x".<br/>
<br/>
Eval&nbsp;compute&nbsp;in<br/>
&nbsp;&nbsp;testParsing&nbsp;parseConjunctionExp&nbsp;"~(x=x&amp;&amp;x*x&lt;=(x*x)*x)&amp;&amp;x=x".<br/>
*)</span><br/>
</div>

<div class="doc">
Parsing commands: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">parseSimpleCommand</span> (<span class="id" title="variable">steps</span>:<span class="id" title="variable">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="variable">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="variable">S</span> <span class="id" title="variable">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">u</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">expect</span> "SKIP" <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">SKIP</span>%<span class="id" title="variable">imp</span>, <span class="id" title="variable">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">e</span>,<span class="id" title="variable">rest</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">firstExpect</span> "TEST"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseBExp</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">c</span>,<span class="id" title="variable">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">firstExpect</span> "THEN"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseSequencedCommand</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">c'</span>,<span class="id" title="variable">rest''</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">firstExpect</span> "ELSE"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseSequencedCommand</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">rest'</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">tt</span>,<span class="id" title="variable">rest'''</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">expect</span> "END" <span class="id" title="variable">rest''</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span>(<span class="id" title="variable">TEST</span> <span class="id" title="variable">e</span> <span class="id" title="variable">THEN</span> <span class="id" title="variable">c</span> <span class="id" title="variable">ELSE</span> <span class="id" title="variable">c'</span> <span class="id" title="variable">FI</span>%<span class="id" title="variable">imp</span>, <span class="id" title="variable">rest'''</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">e</span>,<span class="id" title="variable">rest</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">firstExpect</span> "WHILE"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseBExp</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">c</span>,<span class="id" title="variable">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">firstExpect</span> "DO"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseSequencedCommand</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">u</span>,<span class="id" title="variable">rest''</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">expect</span> "END" <span class="id" title="variable">rest'</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span>(<span class="id" title="variable">WHILE</span> <span class="id" title="variable">e</span> <span class="id" title="variable">DO</span> <span class="id" title="variable">c</span> <span class="id" title="variable">END</span>%<span class="id" title="variable">imp</span>, <span class="id" title="variable">rest''</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">i</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">parseIdentifier</span> <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">e</span>, <span class="id" title="variable">rest'</span>) &lt;- <span class="id" title="variable">firstExpect</span> "<span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>" (<span class="id" title="variable">parseAExp</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> ((<span class="id" title="variable">i</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> <span class="id" title="variable">e</span>)%<span class="id" title="variable">imp</span>, <span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">NoneE</span> "Expecting a command"<br/>
<span class="id" title="keyword">end</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="variable">parseSequencedCommand</span> (<span class="id" title="variable">steps</span>:<span class="id" title="variable">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">xs</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="variable">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="variable">S</span> <span class="id" title="variable">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="variable">c</span>, <span class="id" title="variable">rest</span>) &lt;- <span class="id" title="variable">parseSimpleCommand</span> <span class="id" title="variable">steps'</span> <span class="id" title="variable">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TRY</span> ' (<span class="id" title="variable">c'</span>, <span class="id" title="variable">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">firstExpect</span> ";;"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">parseSequencedCommand</span> <span class="id" title="variable">steps'</span>) <span class="id" title="variable">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> ((<span class="id" title="variable">c</span> ;; <span class="id" title="variable">c'</span>)%<span class="id" title="variable">imp</span>, <span class="id" title="variable">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<span class="id" title="variable">c</span>, <span class="id" title="variable">rest</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">bignumber</span> := 1000.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">parse</span> (<span class="id" title="variable">str</span> : <span class="id" title="variable">string</span>) : <span class="id" title="variable">optionE</span> <span class="id" title="variable">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="variable">tokens</span> := <span class="id" title="variable">tokenize</span> <span class="id" title="variable">str</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">parseSequencedCommand</span> <span class="id" title="variable">bignumber</span> <span class="id" title="variable">tokens</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">SomeE</span> (<span class="id" title="variable">c</span>, []) ⇒ <span class="id" title="variable">SomeE</span> <span class="id" title="variable">c</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">SomeE</span> (<span class="id" title="variable">_</span>, <span class="id" title="variable">t</span>::_) ⇒ <span class="id" title="variable">NoneE</span> ("Trailing tokens remaining: " ++ <span class="id" title="variable">t</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">NoneE</span> <span class="id" title="variable">err</span> ⇒ <span class="id" title="variable">NoneE</span> <span class="id" title="variable">err</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a name="lab419"></a><h1 class="section">Examples</h1>

</div>
<div class="code code-space">

<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">eg<sub>1</sub></span> : <span class="id" title="variable">parse</span> "<br/>
&nbsp;&nbsp;TEST x = y + 1 + 2 - y * 6 + 3 THEN<br/>
&nbsp;&nbsp;&nbsp;&nbsp;x <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> x * 1;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;y <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> 0<br/>
&nbsp;&nbsp;ELSE<br/>
&nbsp;&nbsp;&nbsp;&nbsp;SKIP<br/>
&nbsp;&nbsp;END  "<br/>
=<br/>
&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TEST</span> "x" = "y" + 1 + 2 - "y" * 6 + 3 <span class="id" title="variable">THEN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"x" <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> "x" * 1;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"y" <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">ELSE</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SKIP</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">FI</span>)%<span class="id" title="variable">imp</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="variable">cbv</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">eg<sub>2</sub></span> : <span class="id" title="variable">parse</span> "<br/>
&nbsp;&nbsp;SKIP;;<br/>
&nbsp;&nbsp;z<span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>x*y*(x*x);;<br/>
&nbsp;&nbsp;WHILE x=x DO<br/>
&nbsp;&nbsp;&nbsp;&nbsp;TEST (z ≤ z*z) &amp;&amp; ~(x = 2) THEN<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> z;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> z<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ELSE<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SKIP<br/>
&nbsp;&nbsp;&nbsp;&nbsp;END;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;SKIP<br/>
&nbsp;&nbsp;END;;<br/>
&nbsp;&nbsp;x<span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>z  "<br/>
=<br/>
&nbsp;&nbsp;<span class="id" title="variable">SomeE</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SKIP</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"z" <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> "x" * "y" * ("x" * "x");;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">WHILE</span> "x" = "x" <span class="id" title="variable">DO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TEST</span> ("z" ≤ "z" * "z") &amp;&amp; ~("x" = 2) <span class="id" title="variable">THEN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"x" <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> "z";;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"y" <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> "z"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">ELSE</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SKIP</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">FI</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">SKIP</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">END</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"x" <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> "z")%<span class="id" title="variable">imp</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="variable">cbv</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>



</div>

</body>
</html>