<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="common/css/sf.css" rel="stylesheet" type="text/css"/>
<title>Auto: More Automation</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/lf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 1: Logical Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Auto<span class="subtitle">More Automation</span></h1>



<div class="doc">
Consider the proof below, showing that <span class="inlinecode"><span class="id" title="variable">ceval</span></span> is
    deterministic.  There's a lot of repetition and a lot of
    near-repetition... 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ceval_deterministic</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st<sub>1</sub></span> = <span class="id" title="variable">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>1</sub></span> <span class="id" title="variable">E<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Skip&nbsp;*)</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Ass&nbsp;*)</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="variable">st'</span> = <span class="id" title="variable">st'0</span>) <span class="id" title="keyword">as</span> <span class="id" title="variable">EQ<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Proof&nbsp;of&nbsp;assertion&nbsp;*)</span> <span class="id" title="tactic">apply</span> <span class="id" title="variable">IHE1_1</span>; <span class="id" title="tactic">apply</span> <span class="id" title="variable">H<sub>1</sub></span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="variable">st'0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">IHE1_2</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_IfTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">IHE1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_IfFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">IHE1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_WhileFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_WhileTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="variable">st'</span> = <span class="id" title="variable">st'0</span>) <span class="id" title="keyword">as</span> <span class="id" title="variable">EQ<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Proof&nbsp;of&nbsp;assertion&nbsp;*)</span> <span class="id" title="tactic">apply</span> <span class="id" title="variable">IHE1_1</span>; <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="variable">st'0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">IHE1_2</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab430"></a><h1 class="section">The <span class="inlinecode"><span class="id" title="tactic">auto</span></span> Tactic</h1>

<div class="paragraph"> </div>

 Thus far, our proof scripts mostly apply relevant hypotheses or
    lemmas by name, and one at a time. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_1</span> : <span style='font-size:120%;'>&forall;</span>(<span class="id" title="variable">P</span> <span class="id" title="variable">Q</span> <span class="id" title="variable">R</span>: <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="variable">P</span> → <span class="id" title="variable">Q</span>) → (<span class="id" title="variable">Q</span> → <span class="id" title="variable">R</span>) → <span class="id" title="variable">P</span> → <span class="id" title="variable">R</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">P</span> <span class="id" title="variable">Q</span> <span class="id" title="variable">R</span> <span class="id" title="variable">H<sub>1</sub></span> <span class="id" title="variable">H<sub>2</sub></span> <span class="id" title="variable">H<sub>3</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">H<sub>2</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">H<sub>1</sub></span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="tactic">auto</span></span> tactic frees us from this drudgery by <i>searching</i> for a
    sequence of applications that will prove the goal: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_1'</span> : <span style='font-size:120%;'>&forall;</span>(<span class="id" title="variable">P</span> <span class="id" title="variable">Q</span> <span class="id" title="variable">R</span>: <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="variable">P</span> → <span class="id" title="variable">Q</span>) → (<span class="id" title="variable">Q</span> → <span class="id" title="variable">R</span>) → <span class="id" title="variable">P</span> → <span class="id" title="variable">R</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab431"></a><h3 class="section"> </h3>
 The <span class="inlinecode"><span class="id" title="tactic">auto</span></span> tactic solves goals that are solvable by any combination of

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="tactic">intros</span></span> and

</li>
<li> <span class="inlinecode"><span class="id" title="tactic">apply</span></span> (of hypotheses from the local context, by default). 
</li>
</ul>

<div class="paragraph"> </div>

 Here is a more interesting example showing <span class="inlinecode"><span class="id" title="tactic">auto</span></span>'s power: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_2</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">P</span> <span class="id" title="variable">Q</span> <span class="id" title="variable">R</span> <span class="id" title="variable">S</span> <span class="id" title="variable">T</span> <span class="id" title="variable">U</span> : <span class="id" title="keyword">Prop</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="variable">P</span> → <span class="id" title="variable">Q</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="variable">P</span> → <span class="id" title="variable">R</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="variable">T</span> → <span class="id" title="variable">R</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="variable">S</span> → <span class="id" title="variable">T</span> → <span class="id" title="variable">U</span>) →<br/>
&nbsp;&nbsp;((<span class="id" title="variable">P</span>→<span class="id" title="variable">Q</span>) → (<span class="id" title="variable">P</span>→<span class="id" title="variable">S</span>)) →<br/>
&nbsp;&nbsp;<span class="id" title="variable">T</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">P</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">U</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab432"></a><h3 class="section"> </h3>
 Proof search could, in principle, take an arbitrarily long time,
    so there are limits to how far <span class="inlinecode"><span class="id" title="tactic">auto</span></span> will search by default. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_3</span> : <span style='font-size:120%;'>&forall;</span>(<span class="id" title="variable">P</span> <span class="id" title="variable">Q</span> <span class="id" title="variable">R</span> <span class="id" title="variable">S</span> <span class="id" title="variable">T</span> <span class="id" title="variable">U</span>: <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="variable">P</span> → <span class="id" title="variable">Q</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="variable">Q</span> → <span class="id" title="variable">R</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="variable">R</span> → <span class="id" title="variable">S</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="variable">S</span> → <span class="id" title="variable">T</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="variable">T</span> → <span class="id" title="variable">U</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="variable">P</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">U</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;When&nbsp;it&nbsp;cannot&nbsp;solve&nbsp;the&nbsp;goal,&nbsp;<span class="inlinecode"><span class="id" title="tactic">auto</span></span>&nbsp;does&nbsp;nothing&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Optional&nbsp;argument&nbsp;says&nbsp;how&nbsp;deep&nbsp;to&nbsp;search&nbsp;(default&nbsp;is&nbsp;5)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span> 6.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab433"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="tactic">auto</span></span> considers the hypotheses in the current context
    together with a <i>hint database</i> of other lemmas and constructors.
    Some common facts about equality and logical operators are
    installed in the hint database by default. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_4</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">P</span> <span class="id" title="variable">Q</span> <span class="id" title="variable">R</span> : <span class="id" title="keyword">Prop</span>,<br/>
&nbsp;&nbsp;<span class="id" title="variable">Q</span> →<br/>
&nbsp;&nbsp;(<span class="id" title="variable">Q</span> → <span class="id" title="variable">R</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="variable">P</span> ∨ (<span class="id" title="variable">Q</span> ∧ <span class="id" title="variable">R</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
If we want to see which facts <span class="inlinecode"><span class="id" title="tactic">auto</span></span> is using, we can use
    <span class="inlinecode"><span class="id" title="variable">info_auto</span></span> instead. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_5</span>: 2 = 2.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;auto&nbsp;subsumes&nbsp;reflexivity&nbsp;because&nbsp;eq_refl&nbsp;is&nbsp;in&nbsp;hint&nbsp;database&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="variable">info_auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab434"></a><h3 class="section"> </h3>
 We can extend the hint database just for the purposes of one
    application of <span class="inlinecode"><span class="id" title="tactic">auto</span></span> by writing "<span class="inlinecode"><span class="id" title="tactic">auto</span></span> <span class="inlinecode"><span class="id" title="keyword">using</span></span> <span class="inlinecode">...</span>". 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">le_antisym</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span> <span class="id" title="variable">m</span>: <span class="id" title="variable">nat</span>, (<span class="id" title="variable">n</span> ≤ <span class="id" title="variable">m</span> ∧ <span class="id" title="variable">m</span> ≤ <span class="id" title="variable">n</span>) → <span class="id" title="variable">n</span> = <span class="id" title="variable">m</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">omega</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_6</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span> <span class="id" title="variable">m</span> <span class="id" title="variable">p</span> : <span class="id" title="variable">nat</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="variable">n</span> ≤ <span class="id" title="variable">p</span> → (<span class="id" title="variable">n</span> ≤ <span class="id" title="variable">m</span> ∧ <span class="id" title="variable">m</span> ≤ <span class="id" title="variable">n</span>)) →<br/>
&nbsp;&nbsp;<span class="id" title="variable">n</span> ≤ <span class="id" title="variable">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">n</span> = <span class="id" title="variable">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">using</span> <span class="id" title="variable">le_antisym</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab435"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 We can also permanently extend the hint database:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Resolve</span></span> <span class="inlinecode"><span class="id" title="variable">T</span>.</span>

<div class="paragraph"> </div>

          Add theorem or constructor <span class="inlinecode"><span class="id" title="variable">T</span></span> to the global DB

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="variable">Constructors</span></span> <span class="inlinecode"><span class="id" title="variable">c</span>.</span>

<div class="paragraph"> </div>

          Add <i>all</i> constructors of <span class="inlinecode"><span class="id" title="variable">c</span></span> to the global DB

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Unfold</span></span> <span class="inlinecode"><span class="id" title="variable">d</span>.</span>

<div class="paragraph"> </div>

          Automatically expand defined symbol <span class="inlinecode"><span class="id" title="variable">d</span></span> during <span class="inlinecode"><span class="id" title="tactic">auto</span></span>

</li>
</ul>

<div class="paragraph"> </div>

 It is also possible to define specialized hint databases that can
    be activated only when needed.  See the Coq reference manual for
    more. 
<div class="paragraph"> </div>

<a name="lab436"></a><h3 class="section"> </h3>

</div>
<div class="code code-space">
<span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="variable">le_antisym</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_6'</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span> <span class="id" title="variable">m</span> <span class="id" title="variable">p</span> : <span class="id" title="variable">nat</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="variable">n</span>≤ <span class="id" title="variable">p</span> → (<span class="id" title="variable">n</span> ≤ <span class="id" title="variable">m</span> ∧ <span class="id" title="variable">m</span> ≤ <span class="id" title="variable">n</span>)) →<br/>
&nbsp;&nbsp;<span class="id" title="variable">n</span> ≤ <span class="id" title="variable">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">n</span> = <span class="id" title="variable">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="comment">(*&nbsp;picks&nbsp;up&nbsp;hint&nbsp;from&nbsp;database&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab437"></a><h3 class="section"> </h3>

</div>
<div class="code code-space">
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">is_fortytwo</span> <span class="id" title="variable">x</span> := (<span class="id" title="variable">x</span> = 42).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_7</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">x</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="variable">x</span> ≤ 42 ∧ 42 ≤ <span class="id" title="variable">x</span>) → <span class="id" title="variable">is_fortytwo</span> <span class="id" title="variable">x</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="comment">(*&nbsp;does&nbsp;nothing&nbsp;*)</span><br/>
<span class="id" title="keyword">Abort</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Unfold</span> <span class="id" title="variable">is_fortytwo</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">auto_example_7'</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">x</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="variable">x</span> ≤ 42 ∧ 42 ≤ <span class="id" title="variable">x</span>) → <span class="id" title="variable">is_fortytwo</span> <span class="id" title="variable">x</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="comment">(*&nbsp;try&nbsp;also:&nbsp;info_auto.&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab438"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Let's take a first pass over <span class="inlinecode"><span class="id" title="variable">ceval_deterministic</span></span> to simplify the
    proof script. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ceval_deterministic'</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st<sub>1</sub></span> = <span class="id" title="variable">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>1</sub></span> <span class="id" title="variable">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="variable">st'</span> = <span class="id" title="variable">st'0</span>) <span class="id" title="keyword">as</span> <span class="id" title="variable">EQ<sub>1</sub></span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="variable">st'0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_IfTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_IfFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_WhileFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_WhileTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="variable">st'</span> = <span class="id" title="variable">st'0</span>) <span class="id" title="keyword">as</span> <span class="id" title="variable">EQ<sub>1</sub></span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="variable">st'0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab439"></a><h1 class="section">Searching For Hypotheses</h1>

<div class="paragraph"> </div>

 The proof has become simpler, but there is still an annoying
    amount of repetition.

<div class="paragraph"> </div>

    Let's first tackle the contradiction cases.  Each occurs where we
    have hypothesis of the form

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">H<sub>1</sub></span>:&nbsp;<span class="id" title="variable">beval</span>&nbsp;<span class="id" title="variable">st</span>&nbsp;<span class="id" title="variable">b</span>&nbsp;=&nbsp;<span class="id" title="variable">false</span>
<div class="paragraph"> </div>

</div>
    as well as:

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">H<sub>2</sub></span>:&nbsp;<span class="id" title="variable">beval</span>&nbsp;<span class="id" title="variable">st</span>&nbsp;<span class="id" title="variable">b</span>&nbsp;=&nbsp;<span class="id" title="variable">true</span>
<div class="paragraph"> </div>

</div>

<div class="paragraph"> </div>

    First step: abstracting out that piece of script in Ltac.

</div>
<div class="code code-tight">

<span class="id" title="keyword">Ltac</span> <span class="id" title="variable">rwd</span> <span class="id" title="variable">H<sub>1</sub></span> <span class="id" title="variable">H<sub>2</sub></span> := <span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H<sub>1</sub></span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H<sub>2</sub></span>; <span class="id" title="tactic">discriminate</span>.<br/>
</div>

<div class="doc">
<a name="lab440"></a><h3 class="section"> </h3>
 Using <span class="inlinecode"><span class="id" title="variable">rwd</span></span>... 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ceval_deterministic''</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st<sub>1</sub></span> = <span class="id" title="variable">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>1</sub></span> <span class="id" title="variable">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="variable">st'</span> = <span class="id" title="variable">st'0</span>) <span class="id" title="keyword">as</span> <span class="id" title="variable">EQ<sub>1</sub></span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="variable">st'0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_IfTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">rwd</span> <span class="id" title="variable">H</span> <span class="id" title="variable">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_IfFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">rwd</span> <span class="id" title="variable">H</span> <span class="id" title="variable">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_WhileFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">rwd</span> <span class="id" title="variable">H</span> <span class="id" title="variable">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_WhileTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">rwd</span> <span class="id" title="variable">H</span> <span class="id" title="variable">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="variable">st'</span> = <span class="id" title="variable">st'0</span>) <span class="id" title="keyword">as</span> <span class="id" title="variable">EQ<sub>1</sub></span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="variable">st'0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab441"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 That was a bit better, but we really want Coq to discover the
    relevant hypotheses for us.  We can do this by using the <span class="inlinecode"><span class="id" title="keyword">match</span></span>
    <span class="inlinecode"><span class="id" title="variable">goal</span></span> facility of Ltac. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Ltac</span> <span class="id" title="variable">find_rwd</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">H<sub>1</sub></span>: ?<span class="id" title="variable">E</span> = <span class="id" title="variable">true</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">H<sub>2</sub></span>: ?<span class="id" title="variable">E</span> = <span class="id" title="variable">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="variable">_</span> ⇒ <span class="id" title="variable">rwd</span> <span class="id" title="variable">H<sub>1</sub></span> <span class="id" title="variable">H<sub>2</sub></span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="variable">goal</span></span> tactic looks for hypotheses matching the
    pattern specified. In this case, we're looking for two equalities
    <span class="inlinecode"><span class="id" title="variable">H<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="variable">H<sub>2</sub></span></span> equating the same thing <span class="inlinecode">?<span class="id" title="variable">E</span></span> to <span class="inlinecode"><span class="id" title="variable">true</span></span> and <span class="inlinecode"><span class="id" title="variable">false</span></span>. 
<div class="paragraph"> </div>

<a name="lab442"></a><h3 class="section"> </h3>

</div>
<div class="code code-space">
<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ceval_deterministic'''</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st<sub>1</sub></span> = <span class="id" title="variable">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>1</sub></span> <span class="id" title="variable">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="variable">find_rwd</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="variable">st'</span> = <span class="id" title="variable">st'0</span>) <span class="id" title="keyword">as</span> <span class="id" title="variable">EQ<sub>1</sub></span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="variable">st'0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_WhileTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="variable">st'</span> = <span class="id" title="variable">st'0</span>) <span class="id" title="keyword">as</span> <span class="id" title="variable">EQ<sub>1</sub></span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="variable">st'0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab443"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Now for the remaining cases. Each applies a conditional
    hypothesis to extract an equality. Let's first rephrase a bit,
    replacing our use of assertions by equivalent rewriting. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ceval_deterministic''''</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st<sub>1</sub></span> = <span class="id" title="variable">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>1</sub></span> <span class="id" title="variable">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="variable">find_rwd</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="variable">IHE1_1</span> <span class="id" title="variable">st'0</span> <span class="id" title="variable">H<sub>1</sub></span>) <span class="id" title="keyword">in</span> *. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_WhileTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="variable">IHE1_1</span> <span class="id" title="variable">st'0</span> <span class="id" title="variable">H<sub>3</sub></span>) <span class="id" title="keyword">in</span> *. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab444"></a><h3 class="section"> </h3>
 Now we can automate the task of finding the relevant hypotheses to
    rewrite with. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Ltac</span> <span class="id" title="variable">find_eqn</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">H<sub>1</sub></span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">x</span>, ?<span class="id" title="variable">P</span> <span class="id" title="variable">x</span> → ?<span class="id" title="variable">L</span> = ?<span class="id" title="variable">R</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">H<sub>2</sub></span>: ?<span class="id" title="variable">P</span> ?<span class="id" title="variable">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="variable">_</span> ⇒ <span class="id" title="tactic">rewrite</span> (<span class="id" title="variable">H<sub>1</sub></span> <span class="id" title="variable">X</span> <span class="id" title="variable">H<sub>2</sub></span>) <span class="id" title="keyword">in</span> *<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a name="lab445"></a><h3 class="section"> </h3>
 Now we can make use of <span class="inlinecode"><span class="id" title="variable">find_eqn</span></span> to repeatedly rewrite
    with the appropriate hypothesis, wherever it may be found.

<div class="paragraph"> </div>

    In our example proof, we <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><span class="id" title="variable">find_eqn</span></span>, which will repeatedly
    rewrite until only trivial rewrites are available (since <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span>
    fails when given a trivial equation). 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ceval_deterministic'''''</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st<sub>1</sub></span> = <span class="id" title="variable">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>1</sub></span> <span class="id" title="variable">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="variable">find_rwd</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="variable">find_eqn</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab446"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The big payoff in this approach is that our proof script should be
    more robust in the face of modest changes to our language.  To
    test this, let's try adding a <span class="inlinecode"><span class="id" title="variable">REPEAT</span></span> command to the language. 
</div>
<div class="code code-tight">


<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">com</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="variable">CSkip</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">CAss</span> (<span class="id" title="variable">x</span> : <span class="id" title="variable">string</span>) (<span class="id" title="variable">a</span> : <span class="id" title="variable">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">CSeq</span> (<span class="id" title="variable">c<sub>1</sub></span> <span class="id" title="variable">c<sub>2</sub></span> : <span class="id" title="variable">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">CIf</span> (<span class="id" title="variable">b</span> : <span class="id" title="variable">bexp</span>) (<span class="id" title="variable">c<sub>1</sub></span> <span class="id" title="variable">c<sub>2</sub></span> : <span class="id" title="variable">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">CWhile</span> (<span class="id" title="variable">b</span> : <span class="id" title="variable">bexp</span>) (<span class="id" title="variable">c</span> : <span class="id" title="variable">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">CRepeat</span> (<span class="id" title="variable">c</span> : <span class="id" title="variable">com</span>) (<span class="id" title="variable">b</span> : <span class="id" title="variable">bexp</span>).<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="variable">REPEAT</span></span> behaves like <span class="inlinecode"><span class="id" title="variable">WHILE</span></span>, except that the loop guard is
    checked <i>after</i> each execution of the body, with the loop
    repeating as long as the guard stays <i>false</i>.  Because of this,
    the body will always execute at least once. 
<div class="paragraph"> </div>

<a name="lab447"></a><h3 class="section"> </h3>

</div>
<div class="code code-space">
<span class="id" title="keyword">Notation</span> "'SKIP'" :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="variable">CSkip</span>.<br/>
<span class="id" title="keyword">Notation</span> "x '<span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>' a" :=<br/>
&nbsp;&nbsp;(<span class="id" title="variable">CAss</span> <span class="id" title="variable">x</span> <span class="id" title="variable">a</span>) (<span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 60).<br/>
<span class="id" title="keyword">Notation</span> "c<sub>1</sub> ;; c<sub>2</sub>" :=<br/>
&nbsp;&nbsp;(<span class="id" title="variable">CSeq</span> <span class="id" title="variable">c<sub>1</sub></span> <span class="id" title="variable">c<sub>2</sub></span>) (<span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 80, <span class="id" title="variable">right</span> <span class="id" title="variable">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> "'WHILE' b 'DO' c 'END'" :=<br/>
&nbsp;&nbsp;(<span class="id" title="variable">CWhile</span> <span class="id" title="variable">b</span> <span class="id" title="variable">c</span>) (<span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 80, <span class="id" title="variable">right</span> <span class="id" title="variable">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> "'TEST' c<sub>1</sub> 'THEN' c<sub>2</sub> 'ELSE' c<sub>3</sub> 'FI'" :=<br/>
&nbsp;&nbsp;(<span class="id" title="variable">CIf</span> <span class="id" title="variable">c<sub>1</sub></span> <span class="id" title="variable">c<sub>2</sub></span> <span class="id" title="variable">c<sub>3</sub></span>) (<span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 80, <span class="id" title="variable">right</span> <span class="id" title="variable">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> "'REPEAT' c 'UNTIL' b 'END'" :=<br/>
&nbsp;&nbsp;(<span class="id" title="variable">CRepeat</span> <span class="id" title="variable">c</span> <span class="id" title="variable">b</span>) (<span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 80, <span class="id" title="variable">right</span> <span class="id" title="variable">associativity</span>).<br/>
</div>

<div class="doc">
<a name="lab448"></a><h3 class="section"> </h3>

</div>
<div class="code code-space">
<span class="id" title="keyword">Reserved Notation</span> "st '=[' c ']⇒' st'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 40).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">ceval</span> : <span class="id" title="variable">com</span> → <span class="id" title="variable">state</span> → <span class="id" title="variable">state</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="variable">E_Skip</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">SKIP</span> ]⇒ <span class="id" title="variable">st</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">E_Ass</span>  : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">st</span> <span class="id" title="variable">a<sub>1</sub></span> <span class="id" title="variable">n</span> <span class="id" title="variable">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">aeval</span> <span class="id" title="variable">st</span> <span class="id" title="variable">a<sub>1</sub></span> = <span class="id" title="variable">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">x</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> <span class="id" title="variable">a<sub>1</sub></span> ]⇒ (<span class="id" title="variable">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="variable">n</span> ; <span class="id" title="variable">st</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">E_Seq</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c<sub>1</sub></span> <span class="id" title="variable">c<sub>2</sub></span> <span class="id" title="variable">st</span> <span class="id" title="variable">st'</span> <span class="id" title="variable">st''</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>  =[ <span class="id" title="variable">c<sub>1</sub></span> ]⇒ <span class="id" title="variable">st'</span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st'</span> =[ <span class="id" title="variable">c<sub>2</sub></span> ]⇒ <span class="id" title="variable">st''</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>  =[ <span class="id" title="variable">c<sub>1</sub></span> ;; <span class="id" title="variable">c<sub>2</sub></span> ]⇒ <span class="id" title="variable">st''</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">E_IfTrue</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">st</span> <span class="id" title="variable">st'</span> <span class="id" title="variable">b</span> <span class="id" title="variable">c<sub>1</sub></span> <span class="id" title="variable">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">beval</span> <span class="id" title="variable">st</span> <span class="id" title="variable">b</span> = <span class="id" title="variable">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c<sub>1</sub></span> ]⇒ <span class="id" title="variable">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">TEST</span> <span class="id" title="variable">b</span> <span class="id" title="variable">THEN</span> <span class="id" title="variable">c<sub>1</sub></span> <span class="id" title="variable">ELSE</span> <span class="id" title="variable">c<sub>2</sub></span> <span class="id" title="variable">FI</span> ]⇒ <span class="id" title="variable">st'</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">E_IfFalse</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">st</span> <span class="id" title="variable">st'</span> <span class="id" title="variable">b</span> <span class="id" title="variable">c<sub>1</sub></span> <span class="id" title="variable">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">beval</span> <span class="id" title="variable">st</span> <span class="id" title="variable">b</span> = <span class="id" title="variable">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c<sub>2</sub></span> ]⇒ <span class="id" title="variable">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">TEST</span> <span class="id" title="variable">b</span> <span class="id" title="variable">THEN</span> <span class="id" title="variable">c<sub>1</sub></span> <span class="id" title="variable">ELSE</span> <span class="id" title="variable">c<sub>2</sub></span> <span class="id" title="variable">FI</span> ]⇒ <span class="id" title="variable">st'</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">E_WhileFalse</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">b</span> <span class="id" title="variable">st</span> <span class="id" title="variable">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">beval</span> <span class="id" title="variable">st</span> <span class="id" title="variable">b</span> = <span class="id" title="variable">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">WHILE</span> <span class="id" title="variable">b</span> <span class="id" title="variable">DO</span> <span class="id" title="variable">c</span> <span class="id" title="variable">END</span> ]⇒ <span class="id" title="variable">st</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">E_WhileTrue</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">st</span> <span class="id" title="variable">st'</span> <span class="id" title="variable">st''</span> <span class="id" title="variable">b</span> <span class="id" title="variable">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">beval</span> <span class="id" title="variable">st</span> <span class="id" title="variable">b</span> = <span class="id" title="variable">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>  =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st'</span> =[ <span class="id" title="variable">WHILE</span> <span class="id" title="variable">b</span> <span class="id" title="variable">DO</span> <span class="id" title="variable">c</span> <span class="id" title="variable">END</span> ]⇒ <span class="id" title="variable">st''</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>  =[ <span class="id" title="variable">WHILE</span> <span class="id" title="variable">b</span> <span class="id" title="variable">DO</span> <span class="id" title="variable">c</span> <span class="id" title="variable">END</span> ]⇒ <span class="id" title="variable">st''</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">E_RepeatEnd</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">st</span> <span class="id" title="variable">st'</span> <span class="id" title="variable">b</span> <span class="id" title="variable">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>  =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">beval</span> <span class="id" title="variable">st'</span> <span class="id" title="variable">b</span> = <span class="id" title="variable">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>  =[ <span class="id" title="variable">REPEAT</span> <span class="id" title="variable">c</span> <span class="id" title="variable">UNTIL</span> <span class="id" title="variable">b</span> <span class="id" title="variable">END</span> ]⇒ <span class="id" title="variable">st'</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">E_RepeatLoop</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">st</span> <span class="id" title="variable">st'</span> <span class="id" title="variable">st''</span> <span class="id" title="variable">b</span> <span class="id" title="variable">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>  =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">beval</span> <span class="id" title="variable">st'</span> <span class="id" title="variable">b</span> = <span class="id" title="variable">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st'</span> =[ <span class="id" title="variable">REPEAT</span> <span class="id" title="variable">c</span> <span class="id" title="variable">UNTIL</span> <span class="id" title="variable">b</span> <span class="id" title="variable">END</span> ]⇒ <span class="id" title="variable">st''</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>  =[ <span class="id" title="variable">REPEAT</span> <span class="id" title="variable">c</span> <span class="id" title="variable">UNTIL</span> <span class="id" title="variable">b</span> <span class="id" title="variable">END</span> ]⇒ <span class="id" title="variable">st''</span><br/>
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> "st =[ c ]⇒ st'" := (<span class="id" title="variable">ceval</span> <span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st'</span>).<br/>
</div>

<div class="doc">
<a name="lab449"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Our first attempt at the determinacy proof does not quite succeed:
    the <span class="inlinecode"><span class="id" title="variable">E_RepeatEnd</span></span> and <span class="inlinecode"><span class="id" title="variable">E_RepeatLoop</span></span> cases are not handled by our
    previous automation. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ceval_deterministic</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st<sub>1</sub></span> = <span class="id" title="variable">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>1</sub></span> <span class="id" title="variable">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">E<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="variable">find_rwd</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="variable">find_eqn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_RepeatEnd&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">find_rwd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;oops:&nbsp;why&nbsp;didn't&nbsp;<span class="inlinecode"><span class="id" title="variable">find_rwd</span></span>&nbsp;solve&nbsp;this&nbsp;for&nbsp;us&nbsp;already?<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;answer:&nbsp;we&nbsp;did&nbsp;things&nbsp;in&nbsp;the&nbsp;wrong&nbsp;order.&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_RepeatLoop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">find_rwd</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab450"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Fortunately, to fix this, we just have to swap the invocations of
    <span class="inlinecode"><span class="id" title="variable">find_eqn</span></span> and <span class="inlinecode"><span class="id" title="variable">find_rwd</span></span>. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ceval_deterministic'</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span> =[ <span class="id" title="variable">c</span> ]⇒ <span class="id" title="variable">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st<sub>1</sub></span> = <span class="id" title="variable">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">c</span> <span class="id" title="variable">st</span> <span class="id" title="variable">st<sub>1</sub></span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>1</sub></span> <span class="id" title="variable">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">E<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">st<sub>2</sub></span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="variable">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="variable">find_eqn</span>; <span class="id" title="tactic">try</span> <span class="id" title="variable">find_rwd</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a name="lab451"></a><h2 class="section">The <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> and <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> variants</h2>

<div class="paragraph"> </div>

 Recall this example from the <a href="Imp.html"><span class="inlineref">Imp</span></a> chapter: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Example</span> <span class="id" title="variable">ceval_example1</span>:<br/>
&nbsp;&nbsp;<span class="id" title="variable">empty_st</span> =[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">X</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> 2;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TEST</span> <span class="id" title="variable">X</span> ≤ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">THEN</span> <span class="id" title="variable">Y</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">ELSE</span> <span class="id" title="variable">Z</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> 4<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">FI</span><br/>
&nbsp;&nbsp;]⇒ (<span class="id" title="variable">Z</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 4 ; <span class="id" title="variable">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;supply&nbsp;the&nbsp;intermediate&nbsp;state&nbsp;<span class="inlinecode"><span class="id" title="variable">st'</span></span>...&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">E_Seq</span> <span class="id" title="keyword">with</span> (<span class="id" title="variable">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="variable">E_Ass</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="variable">E_IfFalse</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">E_Ass</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In the first step of the proof, we had to explicitly provide
    a longish expression, due to the "hidden" argument <span class="inlinecode"><span class="id" title="variable">st'</span></span> to the <span class="inlinecode"><span class="id" title="variable">E_Seq</span></span>
    constructor:

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">E_Seq</span>&nbsp;:&nbsp;<span style='font-size:120%;'>&forall;</span><span class="id" title="variable">c<sub>1</sub></span>&nbsp;<span class="id" title="variable">c<sub>2</sub></span>&nbsp;<span class="id" title="variable">st</span>&nbsp;<span class="id" title="variable">st'</span>&nbsp;<span class="id" title="variable">st''</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>&nbsp;&nbsp;=[&nbsp;<span class="id" title="variable">c<sub>1</sub></span>&nbsp;]⇒&nbsp;<span class="id" title="variable">st'</span>&nbsp;&nbsp;→<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st'</span>&nbsp;=[&nbsp;<span class="id" title="variable">c<sub>2</sub></span>&nbsp;]⇒&nbsp;<span class="id" title="variable">st''</span>&nbsp;→<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">st</span>&nbsp;&nbsp;=[&nbsp;<span class="id" title="variable">c<sub>1</sub></span>&nbsp;;;&nbsp;<span class="id" title="variable">c<sub>2</sub></span>&nbsp;]⇒&nbsp;<span class="id" title="variable">st''</span>
<div class="paragraph"> </div>

</div>
 
<div class="paragraph"> </div>

 If we leave out the <span class="inlinecode"><span class="id" title="keyword">with</span></span>, this step fails, because Coq cannot
    find an instance for the variable <span class="inlinecode"><span class="id" title="variable">st'</span></span>. But this is silly! The appropriate
    value for <span class="inlinecode"><span class="id" title="variable">st'</span></span> will become obvious in the very next step. 
<div class="paragraph"> </div>

<a name="lab452"></a><h3 class="section"> </h3>
 With <span class="inlinecode"><span class="id" title="tactic">eapply</span></span>, we can eliminate this silliness: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Example</span> <span class="id" title="variable">ceval'_example1</span>:<br/>
&nbsp;&nbsp;<span class="id" title="variable">empty_st</span> =[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">X</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> 2;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TEST</span> <span class="id" title="variable">X</span> ≤ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">THEN</span> <span class="id" title="variable">Y</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">ELSE</span> <span class="id" title="variable">Z</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> 4<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">FI</span><br/>
&nbsp;&nbsp;]⇒ (<span class="id" title="variable">Z</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 4 ; <span class="id" title="variable">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="variable">E_Seq</span>. <span class="comment">(*&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="variable">E_Ass</span>. <span class="comment">(*&nbsp;2&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="comment">(*&nbsp;3&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;4&nbsp;*)</span> <span class="id" title="tactic">apply</span> <span class="id" title="variable">E_IfFalse</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">E_Ass</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab453"></a><h3 class="section"> </h3>
 Several of the tactics that we've seen so far, including <span class="inlinecode"><span style='font-size:120%;'>&exist;</span></span>,
    <span class="inlinecode"><span class="id" title="variable">constructor</span></span>, and <span class="inlinecode"><span class="id" title="tactic">auto</span></span>, have similar variants.  For example,
    here's a proof using <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Hint</span> <span class="id" title="variable">Constructors</span> <span class="id" title="variable">ceval</span>.<br/>
<span class="id" title="keyword">Hint</span> <span class="id" title="variable">Transparent</span> <span class="id" title="variable">state</span>.<br/>
<span class="id" title="keyword">Hint</span> <span class="id" title="variable">Transparent</span> <span class="id" title="variable">total_map</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">st<sub>12</sub></span> := (<span class="id" title="variable">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2 ; <span class="id" title="variable">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="variable">st<sub>21</sub></span> := (<span class="id" title="variable">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1 ; <span class="id" title="variable">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">eauto_example</span> : <span style='font-size:120%;'>&exist;</span><span class="id" title="variable">s'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="variable">st<sub>21</sub></span> =[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">TEST</span> <span class="id" title="variable">X</span> ≤ <span class="id" title="variable">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">THEN</span> <span class="id" title="variable">Z</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> <span class="id" title="variable">Y</span> - <span class="id" title="variable">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">ELSE</span> <span class="id" title="variable">Y</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> <span class="id" title="variable">X</span> + <span class="id" title="variable">Z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">FI</span><br/>
&nbsp;&nbsp;]⇒ <span class="id" title="variable">s'</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="variable">info_eauto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> tactic works just like <span class="inlinecode"><span class="id" title="tactic">auto</span></span>, except that it uses
    <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> instead of <span class="inlinecode"><span class="id" title="tactic">apply</span></span>; <span class="inlinecode"><span class="id" title="variable">info_eauto</span></span> shows us which facts 
    <span class="inlinecode"><span class="id" title="tactic">auto</span></span> uses.

<div class="paragraph"> </div>

    Pro tip: One might think that, since <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> and <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> are more
    powerful than <span class="inlinecode"><span class="id" title="tactic">apply</span></span> and <span class="inlinecode"><span class="id" title="tactic">auto</span></span>, it would be a good idea to use
    them all the time.  Unfortunately, they are also significantly
    slower &mdash; especially <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>.  Coq experts tend to use <span class="inlinecode"><span class="id" title="tactic">apply</span></span> and
    <span class="inlinecode"><span class="id" title="tactic">auto</span></span> most of the time, only switching to the <span class="inlinecode"><span class="id" title="variable">e</span></span> variants when
    the ordinary variants don't do the job. 
</div>
</div>



</div>

</body>
</html>