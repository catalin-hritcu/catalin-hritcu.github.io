<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="common/css/sf.css" rel="stylesheet" type="text/css"/>
<title>IndProp: Inductively Defined Propositions</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/lf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 1: Logical Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">IndProp<span class="subtitle">Inductively Defined Propositions</span></h1>



<div class="doc">
In the <a href="Logic.html"><span class="inlineref">Logic</span></a> chapter, we looked at several ways of writing
    propositions, including conjunction, disjunction, and existential
    quantification.  In this chapter, we bring yet another new tool
    into the mix: <i>inductive definitions</i>. 
<div class="paragraph"> </div>

<a name="lab234"></a><h3 class="section"> </h3>
 In past chapters, we have seen two ways of stating that a number
    <span class="inlinecode"><span class="id" title="variable">n</span></span> is even: We can say

<div class="paragraph"> </div>

      (1) <span class="inlinecode"><span class="id" title="variable">evenb</span></span> <span class="inlinecode"><span class="id" title="variable">n</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">true</span></span>, or

<div class="paragraph"> </div>

      (2) <span class="inlinecode"><span style='font-size:120%;'>&exist;</span></span> <span class="inlinecode"><span class="id" title="variable">k</span>,</span> <span class="inlinecode"><span class="id" title="variable">n</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">double</span></span> <span class="inlinecode"><span class="id" title="variable">k</span></span>.

<div class="paragraph"> </div>

    Yet another possibility is to say that <span class="inlinecode"><span class="id" title="variable">n</span></span> is even if we can
    establish its evenness from the following rules:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Rule <span class="inlinecode"><span class="id" title="variable">ev_0</span></span>: The number <span class="inlinecode">0</span> is even.

</li>
<li> Rule <span class="inlinecode"><span class="id" title="variable">ev_SS</span></span>: If <span class="inlinecode"><span class="id" title="variable">n</span></span> is even, then <span class="inlinecode"><span class="id" title="variable">S</span></span> <span class="inlinecode">(<span class="id" title="variable">S</span></span> <span class="inlinecode"><span class="id" title="variable">n</span>)</span> is even. 
</li>
</ul>

<div class="paragraph"> </div>

<a name="lab235"></a><h3 class="section"> </h3>
 Such definitions are often presented using <i>inference
    rules</i>, they consist of a line separating the <i>premises</i> above
    from the <i>conclusion</i> below: 
<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ev_0) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">even&nbsp;0</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">even&nbsp;n</td>
  <td class="infrulenamecol" rowspan="3">
    (ev_SS) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">even&nbsp;(S&nbsp;(S&nbsp;n))</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

 We can use a <i>proof tree</i> to display the reasoning
    steps demonstrating that <span class="inlinecode">4</span> is even: 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--------&nbsp;&nbsp;(<span class="id" title="variable">ev_0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">even</span>&nbsp;0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--------&nbsp;(<span class="id" title="variable">ev_SS</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">even</span>&nbsp;2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--------&nbsp;(<span class="id" title="variable">ev_SS</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">even</span>&nbsp;4
<div class="paragraph"> </div>

</div>

<div class="paragraph"> </div>

<a name="lab236"></a><h2 class="section">Inductive Definition of Evenness</h2>

<div class="paragraph"> </div>

 Putting all of this together, we can translate the definition of
    evenness into a formal Coq definition using an <span class="inlinecode"><span class="id" title="keyword">Inductive</span></span>
    declaration, where each constructor corresponds to an inference
    rule: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">even</span> : <span class="id" title="variable">nat</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="variable">ev_0</span> : <span class="id" title="variable">even</span> 0<br/>
| <span class="id" title="variable">ev_SS</span> (<span class="id" title="variable">n</span> : <span class="id" title="variable">nat</span>) (<span class="id" title="variable">H</span> : <span class="id" title="variable">even</span> <span class="id" title="variable">n</span>) : <span class="id" title="variable">even</span> (<span class="id" title="variable">S</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>)).<br/>
</div>

<div class="doc">
We can think of the definition of <span class="inlinecode"><span class="id" title="variable">even</span></span> as defining a Coq
    property <span class="inlinecode"><span class="id" title="variable">even</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="variable">nat</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="keyword">Prop</span></span>, together with primitive theorems
    <span class="inlinecode"><span class="id" title="variable">ev_0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="variable">even</span></span> <span class="inlinecode">0</span> and <span class="inlinecode"><span class="id" title="variable">ev_SS</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span style='font-size:120%;'>&forall;</span></span> <span class="inlinecode"><span class="id" title="variable">n</span>,</span> <span class="inlinecode"><span class="id" title="variable">even</span></span> <span class="inlinecode"><span class="id" title="variable">n</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="variable">even</span></span> <span class="inlinecode">(<span class="id" title="variable">S</span></span> <span class="inlinecode">(<span class="id" title="variable">S</span></span> <span class="inlinecode"><span class="id" title="variable">n</span>))</span>. 
<div class="paragraph"> </div>

 That definition can equivalently be written as follows...

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span>&nbsp;<span class="id" title="variable">even</span>&nbsp;:&nbsp;<span class="id" title="variable">nat</span>&nbsp;→&nbsp;<span class="id" title="keyword">Prop</span>&nbsp;:=<br/>
&nbsp;&nbsp;|&nbsp;<span class="id" title="variable">ev_0</span>&nbsp;:&nbsp;<span class="id" title="variable">even</span>&nbsp;0<br/>
&nbsp;&nbsp;|&nbsp;<span class="id" title="variable">ev_SS</span>&nbsp;:&nbsp;<span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>,&nbsp;<span class="id" title="variable">even</span>&nbsp;<span class="id" title="variable">n</span>&nbsp;→&nbsp;<span class="id" title="variable">even</span>&nbsp;(<span class="id" title="variable">S</span>&nbsp;(<span class="id" title="variable">S</span>&nbsp;<span class="id" title="variable">n</span>)).
<div class="paragraph"> </div>

</div>

<div class="paragraph"> </div>

<a name="lab237"></a><h3 class="section"> </h3>
 Such "constructor theorems" have the same status as proven
    theorems.  In particular, we can use Coq's <span class="inlinecode"><span class="id" title="tactic">apply</span></span> tactic with the
    rule names to prove <span class="inlinecode"><span class="id" title="variable">even</span></span> for particular numbers... 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ev_4</span> : <span class="id" title="variable">even</span> 4.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">ev_SS</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">ev_SS</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">ev_0</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
... or we can use function application syntax: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ev_4'</span> : <span class="id" title="variable">even</span> 4.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="variable">ev_SS</span> 2 (<span class="id" title="variable">ev_SS</span> 0 <span class="id" title="variable">ev_0</span>)). <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We can also prove theorems that have hypotheses involving <span class="inlinecode"><span class="id" title="variable">even</span></span>. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ev_plus4</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>, <span class="id" title="variable">even</span> <span class="id" title="variable">n</span> → <span class="id" title="variable">even</span> (4 + <span class="id" title="variable">n</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="variable">Hn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">ev_SS</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">ev_SS</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">Hn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab238"></a><h1 class="section">Using Evidence in Proofs</h1>

<div class="paragraph"> </div>

 Besides <i>constructing</i> evidence that numbers are even, we can also
    <i>reason about</i> such evidence.

<div class="paragraph"> </div>

    Introducing <span class="inlinecode"><span class="id" title="variable">even</span></span> with an <span class="inlinecode"><span class="id" title="keyword">Inductive</span></span> declaration tells Coq not
    only that the constructors <span class="inlinecode"><span class="id" title="variable">ev_0</span></span> and <span class="inlinecode"><span class="id" title="variable">ev_SS</span></span> are valid ways to
    build evidence that some number is even, but also that these two
    constructors are the <i>only</i> ways to build evidence that numbers
    are even (in the sense of <span class="inlinecode"><span class="id" title="variable">even</span></span>). 
<div class="paragraph"> </div>

<a name="lab239"></a><h3 class="section"> </h3>
 In other words, if someone gives us evidence <span class="inlinecode"><span class="id" title="variable">E</span></span> for the assertion
    <span class="inlinecode"><span class="id" title="variable">even</span></span> <span class="inlinecode"><span class="id" title="variable">n</span></span>, then we know that <span class="inlinecode"><span class="id" title="variable">E</span></span> must have one of two shapes:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="variable">E</span></span> is <span class="inlinecode"><span class="id" title="variable">ev_0</span></span> (and <span class="inlinecode"><span class="id" title="variable">n</span></span> is <span class="inlinecode"><span class="id" title="variable">O</span></span>), or

</li>
<li> <span class="inlinecode"><span class="id" title="variable">E</span></span> is <span class="inlinecode"><span class="id" title="variable">ev_SS</span></span> <span class="inlinecode"><span class="id" title="variable">n'</span></span> <span class="inlinecode"><span class="id" title="variable">E'</span></span> (and <span class="inlinecode"><span class="id" title="variable">n</span></span> is <span class="inlinecode"><span class="id" title="variable">S</span></span> <span class="inlinecode">(<span class="id" title="variable">S</span></span> <span class="inlinecode"><span class="id" title="variable">n'</span>)</span>, where <span class="inlinecode"><span class="id" title="variable">E'</span></span> is
        evidence for <span class="inlinecode"><span class="id" title="variable">even</span></span> <span class="inlinecode"><span class="id" title="variable">n'</span></span>). 
</li>
</ul>

<div class="paragraph"> </div>

 This suggests that it should be possible to do <i>induction</i>
    and <i>case analysis</i> on evidence of evenness... 
<div class="paragraph"> </div>

<a name="lab240"></a><h2 class="section">Inversion on Evidence</h2>

<div class="paragraph"> </div>

 We can prove our characterization of evidence for <span class="inlinecode"><span class="id" title="variable">even</span></span> <span class="inlinecode"><span class="id" title="variable">n</span></span>,
    using <span class="inlinecode"><span class="id" title="tactic">destruct</span></span>. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ev_inversion</span> :<br/>
&nbsp;&nbsp;<span style='font-size:120%;'>&forall;</span>(<span class="id" title="variable">n</span> : <span class="id" title="variable">nat</span>), <span class="id" title="variable">even</span> <span class="id" title="variable">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">n</span> = 0) ∨ (<span style='font-size:120%;'>&exist;</span><span class="id" title="variable">n'</span>, <span class="id" title="variable">n</span> = <span class="id" title="variable">S</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n'</span>) ∧ <span class="id" title="variable">even</span> <span class="id" title="variable">n'</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">E</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="variable">E</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="variable">n'</span> <span class="id" title="variable">E'</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E&nbsp;=&nbsp;ev_0&nbsp;:&nbsp;even&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E&nbsp;=&nbsp;ev_SS&nbsp;n'&nbsp;E'&nbsp;:&nbsp;even&nbsp;(S&nbsp;(S&nbsp;n'))&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">right</span>. <span style='font-size:120%;'>&exist;</span><span class="id" title="variable">n'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">E'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div><div class="quiz"><div>
</div>

<div class="doc">
Which tactics are needed to prove this goal?

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;<span class="id" title="variable">n</span>&nbsp;:&nbsp;<span class="id" title="variable">nat</span><br/>
&nbsp;&nbsp;<span class="id" title="variable">E</span>&nbsp;:&nbsp;<span class="id" title="variable">even</span>&nbsp;<span class="id" title="variable">n</span><br/>
&nbsp;&nbsp;<span class="id" title="variable">F</span>&nbsp;:&nbsp;<span class="id" title="variable">n</span>&nbsp;=&nbsp;1<br/>
&nbsp;&nbsp;======================<br/>
&nbsp;&nbsp;<span class="id" title="variable">true</span>&nbsp;=&nbsp;<span class="id" title="variable">false</span>
<div class="paragraph"> </div>

</div>

<div class="paragraph"> </div>

   (1) <span class="inlinecode"><span class="id" title="tactic">destruct</span></span>

<div class="paragraph"> </div>

   (2) <span class="inlinecode"><span class="id" title="tactic">discriminate</span></span>

<div class="paragraph"> </div>

   (3) <span class="inlinecode"><span class="id" title="tactic">destruct</span></span>, <span class="inlinecode"><span class="id" title="tactic">discriminate</span></span>

<div class="paragraph"> </div>

   (4) These tactics are not sufficient to solve the goal. 
</div>
<div class="code code-tight">
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">quiz_1_not_even</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>, <span class="id" title="variable">even</span> <span class="id" title="variable">n</span> → <span class="id" title="variable">n</span> = 1 → <span class="id" title="variable">true</span> = <span class="id" title="variable">false</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">E</span> <span class="id" title="variable">F</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="variable">E</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="variable">F</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="variable">F</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div >

<br/>
</div>

<div class="doc">
<a name="lab241"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The following theorem can easily be proved using <span class="inlinecode"><span class="id" title="tactic">destruct</span></span> on
    evidence. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">ev_minus2</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="variable">even</span> <span class="id" title="variable">n</span> → <span class="id" title="variable">even</span> (<span class="id" title="variable">pred</span> (<span class="id" title="variable">pred</span> <span class="id" title="variable">n</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">E</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="variable">E</span> <span class="id" title="keyword">as</span> [| <span class="id" title="variable">n'</span> <span class="id" title="variable">E'</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E&nbsp;=&nbsp;ev_0&nbsp;*)</span> <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">ev_0</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E&nbsp;=&nbsp;ev_SS&nbsp;n'&nbsp;E'&nbsp;*)</span> <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">E'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
However, this variation cannot easily be handled with <span class="inlinecode"><span class="id" title="tactic">destruct</span></span>. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">evSS_ev</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="variable">even</span> (<span class="id" title="variable">S</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>)) → <span class="id" title="variable">even</span> <span class="id" title="variable">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">E</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="variable">E</span> <span class="id" title="keyword">as</span> [| <span class="id" title="variable">n'</span> <span class="id" title="variable">E'</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E&nbsp;=&nbsp;ev_0.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;must&nbsp;prove&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="variable">n</span></span>&nbsp;is&nbsp;even&nbsp;from&nbsp;no&nbsp;assumptions!&nbsp;*)</span><br/>
<span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
<a name="lab242"></a><h3 class="section"> </h3>
 The proof is straightforward using our inversion lemma. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">evSS_ev</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>, <span class="id" title="variable">even</span> (<span class="id" title="variable">S</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>)) → <span class="id" title="variable">even</span> <span class="id" title="variable">n</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">ev_inversion</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="variable">H</span>.<br/>
&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="variable">H</span>.<br/>
&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="variable">n'</span> [<span class="id" title="variable">Hnm</span> <span class="id" title="variable">Hev</span>]]. <span class="id" title="tactic">injection</span> <span class="id" title="variable">Hnm</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="variable">Heq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="variable">Heq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">Hev</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Coq provides a tactic called <span class="inlinecode"><span class="id" title="tactic">inversion</span></span>, which does the work of
    our inversion lemma and more besides. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">evSS_ev'</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="variable">even</span> (<span class="id" title="variable">S</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>)) → <span class="id" title="variable">even</span> <span class="id" title="variable">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">E</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="variable">E</span> <span class="id" title="keyword">as</span> [| <span class="id" title="variable">n'</span> <span class="id" title="variable">E'</span> <span class="id" title="variable">EQ</span>].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;are&nbsp;in&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="variable">E</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">ev_SS</span></span> <span class="inlinecode"><span class="id" title="variable">n'</span></span> <span class="inlinecode"><span class="id" title="variable">E'</span></span>&nbsp;case&nbsp;now.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">E'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab243"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> tactic can apply the principle of explosion to
    "obviously contradictory" hypotheses involving inductive
    properties, something that takes a bit more work using our
    inversion lemma. For example: 
</div>
<div class="code code-tight">
<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">one_not_even</span> : ¬<span class="id" title="variable">even</span> 1.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">ev_inversion</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="variable">H</span> <span class="id" title="keyword">as</span> [ | [<span class="id" title="variable">m</span> [<span class="id" title="variable">Hm</span> <span class="id" title="variable">_</span>]]].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="variable">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="variable">Hm</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">one_not_even'</span> : ¬<span class="id" title="variable">even</span> 1.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="variable">H</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab244"></a><h3 class="section"> </h3>
 We can use <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> to reprove some theorems from
    <span class="inlinecode"><span class="id" title="variable">Tactics.v</span></span>. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">inversion_ex<sub>1</sub></span> : <span style='font-size:120%;'>&forall;</span>(<span class="id" title="variable">n</span> <span class="id" title="variable">m</span> <span class="id" title="variable">o</span> : <span class="id" title="variable">nat</span>),<br/>
&nbsp;&nbsp;[<span class="id" title="variable">n</span>; <span class="id" title="variable">m</span>] = [<span class="id" title="variable">o</span>; <span class="id" title="variable">o</span>] →<br/>
&nbsp;&nbsp;[<span class="id" title="variable">n</span>] = [<span class="id" title="variable">m</span>].<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">m</span> <span class="id" title="variable">o</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">inversion_ex<sub>2</sub></span> : <span style='font-size:120%;'>&forall;</span>(<span class="id" title="variable">n</span> : <span class="id" title="variable">nat</span>),<br/>
&nbsp;&nbsp;<span class="id" title="variable">S</span> <span class="id" title="variable">n</span> = <span class="id" title="variable">O</span> →<br/>
&nbsp;&nbsp;2 + 2 = 5.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">contra</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="variable">contra</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab245"></a><h3 class="section"> </h3>
 The tactic <span class="inlinecode"><span class="id" title="tactic">inversion</span></span> actually works on any <span class="inlinecode"><span class="id" title="variable">H</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="variable">P</span></span> where
    <span class="inlinecode"><span class="id" title="variable">P</span></span> is defined by <span class="inlinecode"><span class="id" title="keyword">Inductive</span></span>:

<div class="paragraph"> </div>

<ul class="doclist">
<li> For each constructor of <span class="inlinecode"><span class="id" title="variable">P</span></span>, make a subgoal and replace <span class="inlinecode"><span class="id" title="variable">H</span></span> by
        how exactly this constructor could have been used to prove <span class="inlinecode"><span class="id" title="variable">P</span></span>.

</li>
<li> Discard contradictory subgoals (such as <span class="inlinecode"><span class="id" title="variable">ev_0</span></span> above).

</li>
<li> Generate auxiliary equalities (as with <span class="inlinecode"><span class="id" title="variable">ev_SS</span></span> above). 
</li>
</ul>

</div>
<div class="code code-tight">

</div><div class="quiz"><div>
</div>

<div class="doc">
Which tactics are needed to prove this goal,
    in addition to <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> and <span class="inlinecode"><span class="id" title="tactic">apply</span></span>?

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;<span class="id" title="variable">n</span>&nbsp;:&nbsp;<span class="id" title="variable">nat</span><br/>
&nbsp;&nbsp;<span class="id" title="variable">E</span>&nbsp;:&nbsp;<span class="id" title="variable">even</span>&nbsp;(<span class="id" title="variable">n</span>&nbsp;+&nbsp;2)<br/>
&nbsp;&nbsp;=====================<br/>
&nbsp;&nbsp;<span class="id" title="variable">even</span>&nbsp;<span class="id" title="variable">n</span>
<div class="paragraph"> </div>

</div>

<div class="paragraph"> </div>

   (1) <span class="inlinecode"><span class="id" title="tactic">inversion</span></span>

<div class="paragraph"> </div>

   (2) <span class="inlinecode"><span class="id" title="tactic">inversion</span></span>, <span class="inlinecode"><span class="id" title="tactic">discriminate</span></span>

<div class="paragraph"> </div>

   (3) <span class="inlinecode"><span class="id" title="tactic">inversion</span></span>, <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="variable">plus_comm</span></span>

<div class="paragraph"> </div>

   (4) <span class="inlinecode"><span class="id" title="tactic">inversion</span></span>, <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span> <span class="inlinecode"><span class="id" title="variable">plus_comm</span></span>, <span class="inlinecode"><span class="id" title="tactic">discriminate</span></span>

<div class="paragraph"> </div>

   (5) These tactics are not sufficient to prove the goal.

<div class="paragraph"> </div>

 
</div>
<div class="code code-tight">
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">quiz_even_plus_2</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>, <span class="id" title="variable">even</span> (<span class="id" title="variable">n</span> + 2) → <span class="id" title="variable">even</span> <span class="id" title="variable">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">E</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">plus_comm</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">E</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="variable">E</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">H<sub>0</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div >
</div>

<div class="doc">
<a name="lab246"></a><h3 class="section"> </h3>

</div>
<div class="code code-space">

<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">ev_even_firsttry</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="variable">even</span> <span class="id" title="variable">n</span> → <span style='font-size:120%;'>&exist;</span><span class="id" title="variable">k</span>, <span class="id" title="variable">n</span> = <span class="id" title="variable">double</span> <span class="id" title="variable">k</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span> <span class="id" title="variable">Admitted</span>.<br/>
</div>

<div class="doc">
<a name="lab247"></a><h2 class="section">Induction on Evidence</h2>

<div class="paragraph"> </div>

 Let's try our current lemma again: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">ev_even</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="variable">even</span> <span class="id" title="variable">n</span> → <span style='font-size:120%;'>&exist;</span><span class="id" title="variable">k</span>, <span class="id" title="variable">n</span> = <span class="id" title="variable">double</span> <span class="id" title="variable">k</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">E</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">E</span> <span class="id" title="keyword">as</span> [|<span class="id" title="variable">n'</span> <span class="id" title="variable">E'</span> <span class="id" title="variable">IH</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E&nbsp;=&nbsp;ev_0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='font-size:120%;'>&exist;</span>0. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E&nbsp;=&nbsp;ev_SS&nbsp;n'&nbsp;E'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;IH&nbsp;:&nbsp;exists&nbsp;k',&nbsp;n'&nbsp;=&nbsp;double&nbsp;k'&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="variable">IH</span> <span class="id" title="keyword">as</span> [<span class="id" title="variable">k'</span> <span class="id" title="variable">Hk'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="variable">Hk'</span>. <span style='font-size:120%;'>&exist;</span>(<span class="id" title="variable">S</span> <span class="id" title="variable">k'</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
As we will see in later chapters, induction on evidence is a
    recurring technique across many areas, and in particular when
    formalizing the semantics of programming languages, where many
    properties of interest are defined inductively. 
</div>

<div class="doc">
<a name="lab248"></a><h1 class="section">Inductive Relations</h1>

<div class="paragraph"> </div>

 Just as a single-argument proposition defines a <i>property</i>,
    a two-argument proposition defines a <i>relation</i>. 
</div>

<div class="doc">
One useful example is the "less than or equal to" relation on
    numbers. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">le</span> : <span class="id" title="variable">nat</span> → <span class="id" title="variable">nat</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="variable">le_n</span> <span class="id" title="variable">n</span> : <span class="id" title="variable">le</span> <span class="id" title="variable">n</span> <span class="id" title="variable">n</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">le_S</span> <span class="id" title="variable">n</span> <span class="id" title="variable">m</span> (<span class="id" title="variable">H</span> : <span class="id" title="variable">le</span> <span class="id" title="variable">n</span> <span class="id" title="variable">m</span>) : <span class="id" title="variable">le</span> <span class="id" title="variable">n</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">m</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> "m ≤ n" := (<span class="id" title="variable">le</span> <span class="id" title="variable">m</span> <span class="id" title="variable">n</span>).<br/>
</div>

<div class="doc">
<a name="lab249"></a><h3 class="section"> </h3>
 Some sanity checks... 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">test_le<sub>1</sub></span> :<br/>
&nbsp;&nbsp;3 ≤ 3.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span> <span class="id" title="variable">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">test_le<sub>2</sub></span> :<br/>
&nbsp;&nbsp;3 ≤ 6.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span> <span class="id" title="variable">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">test_le<sub>3</sub></span> :<br/>
&nbsp;&nbsp;(2 ≤ 1) → 2 + 2 = 5.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span> <span class="id" title="variable">Admitted</span>.<br/>
</div>

<div class="doc">
<a name="lab250"></a><h3 class="section"> </h3>
 The "strictly less than" relation <span class="inlinecode"><span class="id" title="variable">n</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="variable">m</span></span> can now be defined
    in terms of <span class="inlinecode"><span class="id" title="variable">le</span></span>. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Definition</span> <span class="id" title="variable">lt</span> (<span class="id" title="variable">n</span> <span class="id" title="variable">m</span>:<span class="id" title="variable">nat</span>) := <span class="id" title="variable">le</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>) <span class="id" title="variable">m</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> "m &lt; n" := (<span class="id" title="variable">lt</span> <span class="id" title="variable">m</span> <span class="id" title="variable">n</span>).<br/>
</div>

<div class="doc">
Here are a few more simple relations on numbers: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">square_of</span> : <span class="id" title="variable">nat</span> → <span class="id" title="variable">nat</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="variable">sq</span> <span class="id" title="variable">n</span> : <span class="id" title="variable">square_of</span> <span class="id" title="variable">n</span> (<span class="id" title="variable">n</span> * <span class="id" title="variable">n</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">next_nat</span> : <span class="id" title="variable">nat</span> → <span class="id" title="variable">nat</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="variable">nn</span> <span class="id" title="variable">n</span> : <span class="id" title="variable">next_nat</span> <span class="id" title="variable">n</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">next_even</span> : <span class="id" title="variable">nat</span> → <span class="id" title="variable">nat</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="variable">ne_1</span> <span class="id" title="variable">n</span> (<span class="id" title="variable">H</span>: <span class="id" title="variable">even</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>)) : <span class="id" title="variable">next_even</span> <span class="id" title="variable">n</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">ne_2</span> <span class="id" title="variable">n</span> (<span class="id" title="variable">H</span>:<span class="id" title="variable">even</span> (<span class="id" title="variable">S</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>))) : <span class="id" title="variable">next_even</span> <span class="id" title="variable">n</span> (<span class="id" title="variable">S</span> (<span class="id" title="variable">S</span> <span class="id" title="variable">n</span>)).<br/>
</div>

<div class="doc">
<a name="lab251"></a><h1 class="section">Case Study: Regular Expressions</h1>

<div class="paragraph"> </div>

 Regular expressions are a simple language for describing sets of
    strings.  Their syntax is defined as follows: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">reg_exp</span> (<span class="id" title="variable">T</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="variable">EmptySet</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">EmptyStr</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">Char</span> (<span class="id" title="variable">t</span> : <span class="id" title="variable">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">App</span> (<span class="id" title="variable">r<sub>1</sub></span> <span class="id" title="variable">r<sub>2</sub></span> : <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">Union</span> (<span class="id" title="variable">r<sub>1</sub></span> <span class="id" title="variable">r<sub>2</sub></span> : <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">Star</span> (<span class="id" title="variable">r</span> : <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="variable">Arguments</span> <span class="id" title="variable">EmptySet</span> {<span class="id" title="variable">T</span>}.<br/>
<span class="id" title="variable">Arguments</span> <span class="id" title="variable">EmptyStr</span> {<span class="id" title="variable">T</span>}.<br/>
<span class="id" title="variable">Arguments</span> <span class="id" title="variable">Char</span> {<span class="id" title="variable">T</span>} <span class="id" title="variable">_</span>.<br/>
<span class="id" title="variable">Arguments</span> <span class="id" title="variable">App</span> {<span class="id" title="variable">T</span>} <span class="id" title="variable">_</span> <span class="id" title="variable">_</span>.<br/>
<span class="id" title="variable">Arguments</span> <span class="id" title="variable">Union</span> {<span class="id" title="variable">T</span>} <span class="id" title="variable">_</span> <span class="id" title="variable">_</span>.<br/>
<span class="id" title="variable">Arguments</span> <span class="id" title="variable">Star</span> {<span class="id" title="variable">T</span>} <span class="id" title="variable">_</span>.<br/>
</div>

<div class="doc">
<a name="lab252"></a><h3 class="section"> </h3>
 We connect regular expressions and strings via the following
    rules, which define when a regular expression <i>matches</i> some
    string:

<div class="paragraph"> </div>

<ul class="doclist">
<li> The expression <span class="inlinecode"><span class="id" title="variable">EmptySet</span></span> does not match any string.

<div class="paragraph"> </div>


</li>
<li> The expression <span class="inlinecode"><span class="id" title="variable">EmptyStr</span></span> matches the empty string <span class="inlinecode">[]</span>.

<div class="paragraph"> </div>


</li>
<li> The expression <span class="inlinecode"><span class="id" title="variable">Char</span></span> <span class="inlinecode"><span class="id" title="variable">x</span></span> matches the one-character string <span class="inlinecode">[<span class="id" title="variable">x</span>]</span>.

<div class="paragraph"> </div>


</li>
<li> If <span class="inlinecode"><span class="id" title="variable">re<sub>1</sub></span></span> matches <span class="inlinecode"><span class="id" title="variable">s<sub>1</sub></span></span>, and <span class="inlinecode"><span class="id" title="variable">re<sub>2</sub></span></span> matches <span class="inlinecode"><span class="id" title="variable">s<sub>2</sub></span></span>,
        then <span class="inlinecode"><span class="id" title="variable">App</span></span> <span class="inlinecode"><span class="id" title="variable">re<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="variable">re<sub>2</sub></span></span> matches <span class="inlinecode"><span class="id" title="variable">s<sub>1</sub></span></span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="variable">s<sub>2</sub></span></span>.

<div class="paragraph"> </div>


</li>
<li> If at least one of <span class="inlinecode"><span class="id" title="variable">re<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="variable">re<sub>2</sub></span></span> matches <span class="inlinecode"><span class="id" title="variable">s</span></span>,
        then <span class="inlinecode"><span class="id" title="variable">Union</span></span> <span class="inlinecode"><span class="id" title="variable">re<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="variable">re<sub>2</sub></span></span> matches <span class="inlinecode"><span class="id" title="variable">s</span></span>.

<div class="paragraph"> </div>


</li>
<li> Finally, if we can write some string <span class="inlinecode"><span class="id" title="variable">s</span></span> as the concatenation
        of a sequence of strings <span class="inlinecode"><span class="id" title="variable">s</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">s_1</span></span> <span class="inlinecode">++</span> <span class="inlinecode">...</span> <span class="inlinecode">++</span> <span class="inlinecode"><span class="id" title="variable">s_k</span></span>, and the
        expression <span class="inlinecode"><span class="id" title="variable">re</span></span> matches each one of the strings <span class="inlinecode"><span class="id" title="variable">s_i</span></span>,
        then <span class="inlinecode"><span class="id" title="variable">Star</span></span> <span class="inlinecode"><span class="id" title="variable">re</span></span> matches <span class="inlinecode"><span class="id" title="variable">s</span></span>.

<div class="paragraph"> </div>

        As a special case, the sequence of strings may be empty, so
        <span class="inlinecode"><span class="id" title="variable">Star</span></span> <span class="inlinecode"><span class="id" title="variable">re</span></span> always matches the empty string <span class="inlinecode">[]</span> no matter what
        <span class="inlinecode"><span class="id" title="variable">re</span></span> is. 
</li>
</ul>

<div class="paragraph"> </div>

<a name="lab253"></a><h3 class="section"> </h3>
 We can easily translate this informal definition into an
    <span class="inlinecode"><span class="id" title="keyword">Inductive</span></span> one as follows.  We use the notation <span class="inlinecode"><span class="id" title="variable">s</span></span> <span class="inlinecode">=~</span> <span class="inlinecode"><span class="id" title="variable">re</span></span> in
    place of <span class="inlinecode"><span class="id" title="variable">exp_match</span></span> <span class="inlinecode"><span class="id" title="variable">s</span></span> <span class="inlinecode"><span class="id" title="variable">re</span></span>; by "reserving" the notation before
    defining the <span class="inlinecode"><span class="id" title="keyword">Inductive</span></span>, we can use it in the definition! 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Reserved Notation</span> "s =~ re" (<span class="id" title="tactic">at</span> <span class="id" title="variable">level</span> 80).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">exp_match</span> {<span class="id" title="variable">T</span>} : <span class="id" title="variable">list</span> <span class="id" title="variable">T</span> → <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="variable">MEmpty</span> : [] =~ <span class="id" title="variable">EmptyStr</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">MChar</span> <span class="id" title="variable">x</span> : [<span class="id" title="variable">x</span>] =~ (<span class="id" title="variable">Char</span> <span class="id" title="variable">x</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">MApp</span> <span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">re<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">H<sub>1</sub></span> : <span class="id" title="variable">s<sub>1</sub></span> =~ <span class="id" title="variable">re<sub>1</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">H<sub>2</sub></span> : <span class="id" title="variable">s<sub>2</sub></span> =~ <span class="id" title="variable">re<sub>2</sub></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">s<sub>1</sub></span> ++ <span class="id" title="variable">s<sub>2</sub></span>) =~ (<span class="id" title="variable">App</span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">re<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">MUnionL</span> <span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">re<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">H<sub>1</sub></span> : <span class="id" title="variable">s<sub>1</sub></span> =~ <span class="id" title="variable">re<sub>1</sub></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">s<sub>1</sub></span> =~ (<span class="id" title="variable">Union</span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">re<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">MUnionR</span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">re<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">H<sub>2</sub></span> : <span class="id" title="variable">s<sub>2</sub></span> =~ <span class="id" title="variable">re<sub>2</sub></span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">s<sub>2</sub></span> =~ (<span class="id" title="variable">Union</span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">re<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">MStar0</span> <span class="id" title="variable">re</span> : [] =~ (<span class="id" title="variable">Star</span> <span class="id" title="variable">re</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="variable">MStarApp</span> <span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">re</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">H<sub>1</sub></span> : <span class="id" title="variable">s<sub>1</sub></span> =~ <span class="id" title="variable">re</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">H<sub>2</sub></span> : <span class="id" title="variable">s<sub>2</sub></span> =~ (<span class="id" title="variable">Star</span> <span class="id" title="variable">re</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="variable">s<sub>1</sub></span> ++ <span class="id" title="variable">s<sub>2</sub></span>) =~ (<span class="id" title="variable">Star</span> <span class="id" title="variable">re</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> "s =~ re" := (<span class="id" title="variable">exp_match</span> <span class="id" title="variable">s</span> <span class="id" title="variable">re</span>).<br/>
</div><div class="quiz"><div>
</div>

<div class="doc">
Notice that this clause in our informal definition...

<div class="paragraph"> </div>

<ul class="doclist">
<li> The expression <span class="inlinecode"><span class="id" title="variable">EmptySet</span></span> does not match any string.

</li>
</ul>

<div class="paragraph"> </div>

    ... is not explicitly reflected in the above definition.  Do we
    need to add something?

<div class="paragraph"> </div>

   (1) Yes, we should add a rule for this.

<div class="paragraph"> </div>

   (2) No, one of the other rules already covers this case.

<div class="paragraph"> </div>

   (3) No, the <i>lack</i> of a rule actually gives us the behavior we
       want.

<div class="paragraph"> </div>


</div>
<div class="code code-tight">
</div >
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">quiz</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">T</span> (<span class="id" title="variable">s</span>:<span class="id" title="variable">list</span> <span class="id" title="variable">T</span>), ~(<span class="id" title="variable">s</span> =~ <span class="id" title="variable">EmptySet</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="variable">T</span> <span class="id" title="variable">s</span> <span class="id" title="variable">Hc</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="variable">Hc</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a name="lab254"></a><h3 class="section"> </h3>
 Again, for readability, we can also display this definition using
    inference-rule notation. 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (MEmpty) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">[]&nbsp;=~&nbsp;EmptyStr</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (MChar) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">[x]&nbsp;=~&nbsp;Char&nbsp;x</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">s<sub>1</sub>&nbsp;=~&nbsp;re<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;s<sub>2</sub>&nbsp;=~&nbsp;re<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (MApp) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">s<sub>1</sub>&nbsp;++&nbsp;s<sub>2</sub>&nbsp;=~&nbsp;App&nbsp;re<sub>1</sub>&nbsp;re<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">s<sub>1</sub>&nbsp;=~&nbsp;re<sub>1</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (MUnionL) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">s<sub>1</sub>&nbsp;=~&nbsp;Union&nbsp;re<sub>1</sub>&nbsp;re<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">s<sub>2</sub>&nbsp;=~&nbsp;re<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (MUnionR) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">s<sub>2</sub>&nbsp;=~&nbsp;Union&nbsp;re<sub>1</sub>&nbsp;re<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (MStar0) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">[]&nbsp;=~&nbsp;Star&nbsp;re</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">s<sub>1</sub>&nbsp;=~&nbsp;re&nbsp;&nbsp;&nbsp;&nbsp;s<sub>2</sub>&nbsp;=~&nbsp;Star&nbsp;re</td>
  <td class="infrulenamecol" rowspan="3">
    (MStarApp) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">s<sub>1</sub>&nbsp;++&nbsp;s<sub>2</sub>&nbsp;=~&nbsp;Star&nbsp;re</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a name="lab255"></a><h3 class="section"> </h3>

</div>
<div class="code code-space">
<span class="id" title="keyword">Example</span> <span class="id" title="variable">reg_exp_ex<sub>1</sub></span> : [1] =~ <span class="id" title="variable">Char</span> 1.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">MChar</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">reg_exp_ex<sub>2</sub></span> : [1; 2] =~ <span class="id" title="variable">App</span> (<span class="id" title="variable">Char</span> 1) (<span class="id" title="variable">Char</span> 2).<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="variable">MApp</span> [1] <span class="id" title="variable">_</span> [2]).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="variable">MChar</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="variable">MChar</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">reg_exp_ex<sub>3</sub></span> : ¬([1; 2] =~ <span class="id" title="variable">Char</span> 1).<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="variable">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a name="lab256"></a><h3 class="section"> </h3>
 We can define helper functions for writing down regular
    expressions. The <span class="inlinecode"><span class="id" title="variable">reg_exp_of_list</span></span> function constructs a regular
    expression that matches exactly the list that it receives as an
    argument: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">reg_exp_of_list</span> {<span class="id" title="variable">T</span>} (<span class="id" title="variable">l</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">T</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] ⇒ <span class="id" title="variable">EmptyStr</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">x</span> :: <span class="id" title="variable">l'</span> ⇒ <span class="id" title="variable">App</span> (<span class="id" title="variable">Char</span> <span class="id" title="variable">x</span>) (<span class="id" title="variable">reg_exp_of_list</span> <span class="id" title="variable">l'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="variable">reg_exp_ex<sub>4</sub></span> : [1; 2; 3] =~ <span class="id" title="variable">reg_exp_of_list</span> [1; 2; 3].<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="variable">MApp</span> [1]).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="variable">MChar</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="variable">MApp</span> [2]).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="variable">MChar</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="variable">MApp</span> [3]).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="variable">MChar</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">MEmpty</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a name="lab257"></a><h3 class="section"> </h3>
 Something more interesting: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">MStar1</span> :<br/>
&nbsp;&nbsp;<span style='font-size:120%;'>&forall;</span><span class="id" title="variable">T</span> <span class="id" title="variable">s</span> (<span class="id" title="variable">re</span> : <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span>) ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">s</span> =~ <span class="id" title="variable">re</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">s</span> =~ <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span>.<br/>
<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span> <span class="id" title="variable">Admitted</span>.<br/>
</div>

<div class="doc">
<a name="lab258"></a><h3 class="section"> </h3>
 Naturally, proofs about <span class="inlinecode"><span class="id" title="variable">exp_match</span></span> often require induction. 
<div class="paragraph"> </div>

 For example, suppose that we wanted to prove the following
    intuitive result: If a regular expression <span class="inlinecode"><span class="id" title="variable">re</span></span> matches some string
    <span class="inlinecode"><span class="id" title="variable">s</span></span>, then all elements of <span class="inlinecode"><span class="id" title="variable">s</span></span> must occur as character literals
    somewhere in <span class="inlinecode"><span class="id" title="variable">re</span></span>.

<div class="paragraph"> </div>

    To state this theorem, we first define a function <span class="inlinecode"><span class="id" title="variable">re_chars</span></span> that
    lists all characters that occur in a regular expression: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="variable">re_chars</span> {<span class="id" title="variable">T</span>} (<span class="id" title="variable">re</span> : <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span>) : <span class="id" title="variable">list</span> <span class="id" title="variable">T</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="variable">re</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">EmptySet</span> ⇒ []<br/>
&nbsp;&nbsp;| <span class="id" title="variable">EmptyStr</span> ⇒ []<br/>
&nbsp;&nbsp;| <span class="id" title="variable">Char</span> <span class="id" title="variable">x</span> ⇒ [<span class="id" title="variable">x</span>]<br/>
&nbsp;&nbsp;| <span class="id" title="variable">App</span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">re<sub>2</sub></span> ⇒ <span class="id" title="variable">re_chars</span> <span class="id" title="variable">re<sub>1</sub></span> ++ <span class="id" title="variable">re_chars</span> <span class="id" title="variable">re<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">Union</span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">re<sub>2</sub></span> ⇒ <span class="id" title="variable">re_chars</span> <span class="id" title="variable">re<sub>1</sub></span> ++ <span class="id" title="variable">re_chars</span> <span class="id" title="variable">re<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span> ⇒ <span class="id" title="variable">re_chars</span> <span class="id" title="variable">re</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a name="lab259"></a><h3 class="section"> </h3>

</div>
<div class="code code-space">

<br/>
<span class="comment">(*&nbsp;Sooner:&nbsp;BCP:&nbsp;Recheck&nbsp;the&nbsp;HIDEFROMHTML&nbsp;stuff&nbsp;around&nbsp;here...&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">in_re_match</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">T</span> (<span class="id" title="variable">s</span> : <span class="id" title="variable">list</span> <span class="id" title="variable">T</span>) (<span class="id" title="variable">re</span> : <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span>) (<span class="id" title="variable">x</span> : <span class="id" title="variable">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="variable">s</span> =~ <span class="id" title="variable">re</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">In</span> <span class="id" title="variable">x</span> <span class="id" title="variable">s</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">In</span> <span class="id" title="variable">x</span> (<span class="id" title="variable">re_chars</span> <span class="id" title="variable">re</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">T</span> <span class="id" title="variable">s</span> <span class="id" title="variable">re</span> <span class="id" title="variable">x</span> <span class="id" title="variable">Hmatch</span> <span class="id" title="variable">Hin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">Hmatch</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [| <span class="id" title="variable">x'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">re<sub>2</sub></span> <span class="id" title="variable">Hmatch1</span> <span class="id" title="variable">IH<sub>1</sub></span> <span class="id" title="variable">Hmatch2</span> <span class="id" title="variable">IH<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">re<sub>2</sub></span> <span class="id" title="variable">Hmatch</span> <span class="id" title="variable">IH</span> | <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">re<sub>2</sub></span> <span class="id" title="variable">Hmatch</span> <span class="id" title="variable">IH</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="variable">re</span> | <span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">re</span> <span class="id" title="variable">Hmatch1</span> <span class="id" title="variable">IH<sub>1</sub></span> <span class="id" title="variable">Hmatch2</span> <span class="id" title="variable">IH<sub>2</sub></span>].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span> <span class="id" title="variable">Admitted</span>.<br/>
</div>

<div class="doc">
<a name="lab261"></a><h2 class="section">The <span class="inlinecode"><span class="id" title="variable">remember</span></span> Tactic</h2>

<div class="paragraph"> </div>

 One potentially confusing feature of the <span class="inlinecode"><span class="id" title="tactic">induction</span></span> tactic is
    that it will let you try to perform an induction over a term that
    isn't sufficiently general.  The effect of this is to lose
    information (much as <span class="inlinecode"><span class="id" title="tactic">destruct</span></span> without an <span class="inlinecode"><span class="id" title="variable">eqn</span>:</span> clause can do),
    and leave you unable to complete the proof.  Here's an example: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">star_app</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">T</span> (<span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> : <span class="id" title="variable">list</span> <span class="id" title="variable">T</span>) (<span class="id" title="variable">re</span> : <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="variable">s<sub>1</sub></span> =~ <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">s<sub>2</sub></span> =~ <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">s<sub>1</sub></span> ++ <span class="id" title="variable">s<sub>2</sub></span> =~ <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">T</span> <span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">re</span> <span class="id" title="variable">H<sub>1</sub></span>.<br/>
</div>

<div class="doc">
A naive first attempt at setting up the induction.  (Note
    that we are performing induction on evidence!) 
</div>
<div class="code code-tight">

&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">H<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [|<span class="id" title="variable">x'</span>|<span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub>'</span> <span class="id" title="variable">re<sub>2</sub></span> <span class="id" title="variable">Hmatch1</span> <span class="id" title="variable">IH<sub>1</sub></span> <span class="id" title="variable">Hmatch2</span> <span class="id" title="variable">IH<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">re<sub>2</sub></span> <span class="id" title="variable">Hmatch</span> <span class="id" title="variable">IH</span>|<span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub>'</span> <span class="id" title="variable">re<sub>2</sub></span> <span class="id" title="variable">Hmatch</span> <span class="id" title="variable">IH</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="variable">re''</span>|<span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub>'</span> <span class="id" title="variable">re''</span> <span class="id" title="variable">Hmatch1</span> <span class="id" title="variable">IH<sub>1</sub></span> <span class="id" title="variable">Hmatch2</span> <span class="id" title="variable">IH<sub>2</sub></span>].<br/>
</div>

<div class="doc">
<a name="lab262"></a><h3 class="section"> </h3>
 We can get through the first case... 
</div>
<div class="code code-tight">

&nbsp;&nbsp;- <span class="comment">(*&nbsp;MEmpty&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">H</span>.<br/>
</div>

<div class="doc">
... but most cases get stuck.  For <span class="inlinecode"><span class="id" title="variable">MChar</span></span>, for instance, we
    must show that

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">s<sub>2</sub></span>&nbsp;=~&nbsp;<span class="id" title="variable">Char</span>&nbsp;<span class="id" title="variable">x'</span>&nbsp;→&nbsp;<span class="id" title="variable">x'</span>&nbsp;::&nbsp;<span class="id" title="variable">s<sub>2</sub></span>&nbsp;=~&nbsp;<span class="id" title="variable">Char</span>&nbsp;<span class="id" title="variable">x'</span>,
<div class="paragraph"> </div>

</div>
    which is clearly impossible. 
</div>
<div class="code code-tight">

&nbsp;&nbsp;- <span class="comment">(*&nbsp;MChar.&nbsp;*)</span> <span class="id" title="tactic">intros</span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">simpl</span>. <span class="comment">(*&nbsp;Stuck...&nbsp;*)</span><br/>
<span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
<a name="lab263"></a><h3 class="section"> </h3>
 The problem is that <span class="inlinecode"><span class="id" title="tactic">induction</span></span> over a Prop hypothesis only works
    properly with hypotheses that are completely general, i.e., ones
    in which all the arguments are variables, as opposed to more
    complex expressions, such as <span class="inlinecode"><span class="id" title="variable">Star</span></span> <span class="inlinecode"><span class="id" title="variable">re</span></span>.

<div class="paragraph"> </div>

    An awkward way to solve this problem is "manually generalizing" 
    over the problematic expressions by adding explicit equality 
    hypotheses to the lemma: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">star_app</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">T</span> (<span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> : <span class="id" title="variable">list</span> <span class="id" title="variable">T</span>) (<span class="id" title="variable">re</span> <span class="id" title="variable">re'</span> : <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="variable">re'</span> = <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">s<sub>1</sub></span> =~ <span class="id" title="variable">re'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">s<sub>2</sub></span> =~ <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">s<sub>1</sub></span> ++ <span class="id" title="variable">s<sub>2</sub></span> =~ <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span>.<br/>
</div>

<div class="doc">
This works, but it requires making the statement of the lemma
    a bit ugly, which is a shame.  Fortunately, there is a better way: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Abort</span>.<br/>
</div>

<div class="doc">
<a name="lab264"></a><h3 class="section"> </h3>
 The tactic <span class="inlinecode"><span class="id" title="variable">remember</span></span> <span class="inlinecode"><span class="id" title="variable">e</span></span> <span class="inlinecode"><span class="id" title="keyword">as</span></span> <span class="inlinecode"><span class="id" title="variable">x</span></span> causes Coq to (1) replace all
    occurrences of the expression <span class="inlinecode"><span class="id" title="variable">e</span></span> by the variable <span class="inlinecode"><span class="id" title="variable">x</span></span>, and (2) add
    an equation <span class="inlinecode"><span class="id" title="variable">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">e</span></span> to the context.  Here's how we can use it to
    show the above result: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">star_app</span>: <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">T</span> (<span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> : <span class="id" title="variable">list</span> <span class="id" title="variable">T</span>) (<span class="id" title="variable">re</span> : <span class="id" title="variable">reg_exp</span> <span class="id" title="variable">T</span>),<br/>
&nbsp;&nbsp;<span class="id" title="variable">s<sub>1</sub></span> =~ <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">s<sub>2</sub></span> =~ <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span> →<br/>
&nbsp;&nbsp;<span class="id" title="variable">s<sub>1</sub></span> ++ <span class="id" title="variable">s<sub>2</sub></span> =~ <span class="id" title="variable">Star</span> <span class="id" title="variable">re</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">T</span> <span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">re</span> <span class="id" title="variable">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="variable">remember</span> (<span class="id" title="variable">Star</span> <span class="id" title="variable">re</span>) <span class="id" title="keyword">as</span> <span class="id" title="variable">re'</span>.<br/>
</div>

<div class="doc">
We now have <span class="inlinecode"><span class="id" title="variable">Heqre'</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="variable">re'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">Star</span></span> <span class="inlinecode"><span class="id" title="variable">re</span></span>. 
</div>
<div class="code code-tight">

&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="variable">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="variable">H<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [|<span class="id" title="variable">x'</span>|<span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub>'</span> <span class="id" title="variable">re<sub>2</sub></span> <span class="id" title="variable">Hmatch1</span> <span class="id" title="variable">IH<sub>1</sub></span> <span class="id" title="variable">Hmatch2</span> <span class="id" title="variable">IH<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">re<sub>2</sub></span> <span class="id" title="variable">Hmatch</span> <span class="id" title="variable">IH</span>|<span class="id" title="variable">re<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub>'</span> <span class="id" title="variable">re<sub>2</sub></span> <span class="id" title="variable">Hmatch</span> <span class="id" title="variable">IH</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="variable">re''</span>|<span class="id" title="variable">s<sub>1</sub></span> <span class="id" title="variable">s<sub>2</sub>'</span> <span class="id" title="variable">re''</span> <span class="id" title="variable">Hmatch1</span> <span class="id" title="variable">IH<sub>1</sub></span> <span class="id" title="variable">Hmatch2</span> <span class="id" title="variable">IH<sub>2</sub></span>].<br/>
</div>

<div class="doc">
<a name="lab265"></a><h3 class="section"> </h3>
 The <span class="inlinecode"><span class="id" title="variable">Heqre'</span></span> is contradictory in most cases, allowing us to
    conclude immediately. 
</div>
<div class="code code-tight">

&nbsp;&nbsp;- <span class="comment">(*&nbsp;MEmpty&nbsp;*)</span>  <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;MChar&nbsp;*)</span>   <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;MApp&nbsp;*)</span>    <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;MUnionL&nbsp;*)</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;MUnionR&nbsp;*)</span> <span class="id" title="tactic">discriminate</span>.<br/>
</div>

<div class="doc">
The interesting cases are those that correspond to <span class="inlinecode"><span class="id" title="variable">Star</span></span>.  Note
    that the induction hypothesis <span class="inlinecode"><span class="id" title="variable">IH<sub>2</sub></span></span> on the <span class="inlinecode"><span class="id" title="variable">MStarApp</span></span> case
    mentions an additional premise <span class="inlinecode"><span class="id" title="variable">Star</span></span> <span class="inlinecode"><span class="id" title="variable">re''</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">Star</span></span> <span class="inlinecode"><span class="id" title="variable">re</span></span>, which
    results from the equality generated by <span class="inlinecode"><span class="id" title="variable">remember</span></span>. 
</div>
<div class="code code-tight">

&nbsp;&nbsp;- <span class="comment">(*&nbsp;MStar0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="variable">Heqre'</span>. <span class="id" title="tactic">intros</span> <span class="id" title="variable">Heqre''</span> <span class="id" title="variable">s</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">H</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;MStarApp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="variable">Heqre'</span>. <span class="id" title="tactic">intros</span> <span class="id" title="variable">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">s<sub>2</sub></span> <span class="id" title="variable">H<sub>1</sub></span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="variable">app_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="variable">MStarApp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="variable">Hmatch1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="variable">IH<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H<sub>0</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="variable">H<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab266"></a><h1 class="section">Case Study: Improving Reflection</h1>

<div class="paragraph"> </div>

 We've seen that we often need to relate boolean
    computations to statements in <span class="inlinecode"><span class="id" title="keyword">Prop</span></span>.  Unfortunately, this can
    sometimes result in tedious proof scripts.  Consider: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">filter_not_empty_In</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span> <span class="id" title="variable">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="variable">filter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="variable">x</span> ⇒ <span class="id" title="variable">n</span> =? <span class="id" title="variable">x</span>) <span class="id" title="variable">l</span> ≠ [] →<br/>
&nbsp;&nbsp;<span class="id" title="variable">In</span> <span class="id" title="variable">n</span> <span class="id" title="variable">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">l</span>. <span class="id" title="tactic">induction</span> <span class="id" title="variable">l</span> <span class="id" title="keyword">as</span> [|<span class="id" title="variable">m</span> <span class="id" title="variable">l'</span> <span class="id" title="variable">IHl'</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;l&nbsp;=&nbsp;<span class="inlinecode"></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;l&nbsp;=&nbsp;m&nbsp;::&nbsp;l'&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="variable">n</span> =? <span class="id" title="variable">m</span>) <span class="id" title="variable">eqn</span>:<span class="id" title="variable">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;n&nbsp;=?&nbsp;m&nbsp;=&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">_</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="variable">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="variable">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;n&nbsp;=?&nbsp;m&nbsp;=&nbsp;false&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">H'</span>. <span class="id" title="variable">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">IHl'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">H'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The first subcase (where <span class="inlinecode"><span class="id" title="variable">n</span></span> <span class="inlinecode">=?</span> <span class="inlinecode"><span class="id" title="variable">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">true</span></span>) is a bit awkward.

<div class="paragraph"> </div>

    It would be annoying to have to do this kind of thing all the
    time. 
<div class="paragraph"> </div>

<a name="lab267"></a><h3 class="section"> </h3>
 We can streamline this by defining an inductive proposition that
    yields a better case-analysis principle for <span class="inlinecode"><span class="id" title="variable">n</span></span> <span class="inlinecode">=?</span> <span class="inlinecode"><span class="id" title="variable">m</span></span>.
    Instead of generating an equation such as <span class="inlinecode">(<span class="id" title="variable">n</span></span> <span class="inlinecode">=?</span> <span class="inlinecode"><span class="id" title="variable">m</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">true</span></span>,
    which is generally not directly useful, this principle gives us
    right away the assumption we really need: <span class="inlinecode"><span class="id" title="variable">n</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="variable">m</span></span>. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Inductive</span> <span class="id" title="variable">reflect</span> (<span class="id" title="variable">P</span> : <span class="id" title="keyword">Prop</span>) : <span class="id" title="variable">bool</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="variable">ReflectT</span> (<span class="id" title="variable">H</span> :   <span class="id" title="variable">P</span>) : <span class="id" title="variable">reflect</span> <span class="id" title="variable">P</span> <span class="id" title="variable">true</span><br/>
| <span class="id" title="variable">ReflectF</span> (<span class="id" title="variable">H</span> : ¬<span class="id" title="variable">P</span>) : <span class="id" title="variable">reflect</span> <span class="id" title="variable">P</span> <span class="id" title="variable">false</span>.<br/>
</div>

<div class="doc">
The only way to produce evidence for <span class="inlinecode"><span class="id" title="variable">reflect</span></span> <span class="inlinecode"><span class="id" title="variable">P</span></span> <span class="inlinecode"><span class="id" title="variable">true</span></span> is by
    showing <span class="inlinecode"><span class="id" title="variable">P</span></span> and using the <span class="inlinecode"><span class="id" title="variable">ReflectT</span></span> constructor.

<div class="paragraph"> </div>

    If we invert this reasoning, it says we can extract <i>evidence</i> for
    <span class="inlinecode"><span class="id" title="variable">P</span></span> from evidence for <span class="inlinecode"><span class="id" title="variable">reflect</span></span> <span class="inlinecode"><span class="id" title="variable">P</span></span> <span class="inlinecode"><span class="id" title="variable">true</span></span>. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">iff_reflect</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">P</span> <span class="id" title="variable">b</span>, (<span class="id" title="variable">P</span> ↔ <span class="id" title="variable">b</span> = <span class="id" title="variable">true</span>) → <span class="id" title="variable">reflect</span> <span class="id" title="variable">P</span> <span class="id" title="variable">b</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;WORK&nbsp;IN&nbsp;CLASS&nbsp;*)</span> <span class="id" title="variable">Admitted</span>.<br/>
</div>

<div class="doc">
(The right-to-left implication is left as an exercise.) 
<div class="paragraph"> </div>

<a name="lab268"></a><h3 class="section"> </h3>
 The advantage of <span class="inlinecode"><span class="id" title="variable">reflect</span></span> over the normal "if and only if"
    connective is that, by destructing a hypothesis or lemma of the
    form <span class="inlinecode"><span class="id" title="variable">reflect</span></span> <span class="inlinecode"><span class="id" title="variable">P</span></span> <span class="inlinecode"><span class="id" title="variable">b</span></span>, we can perform case analysis on <span class="inlinecode"><span class="id" title="variable">b</span></span> while at
    the same time generating appropriate hypothesis in the two
    branches (<span class="inlinecode"><span class="id" title="variable">P</span></span> in the first subgoal and <span class="inlinecode">¬</span> <span class="inlinecode"><span class="id" title="variable">P</span></span> in the second). 
<div class="paragraph"> </div>

<a name="lab269"></a><h3 class="section"> </h3>
 To use <span class="inlinecode"><span class="id" title="variable">reflect</span></span> to produce a better proof of
    <span class="inlinecode"><span class="id" title="variable">filter_not_empty_In</span></span>, we begin by recasting the <span class="inlinecode"><span class="id" title="variable">eqb_iff_true</span></span>
    lemma in terms of <span class="inlinecode"><span class="id" title="variable">reflect</span></span>: 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Lemma</span> <span class="id" title="variable">eqbP</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span> <span class="id" title="variable">m</span>, <span class="id" title="variable">reflect</span> (<span class="id" title="variable">n</span> = <span class="id" title="variable">m</span>) (<span class="id" title="variable">n</span> =? <span class="id" title="variable">m</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">iff_reflect</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="variable">eqb_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab270"></a><h3 class="section"> </h3>
 A smoother proof of <span class="inlinecode"><span class="id" title="variable">filter_not_empty_In</span></span> now goes as follows.
    Notice how the calls to <span class="inlinecode"><span class="id" title="tactic">destruct</span></span> and <span class="inlinecode"><span class="id" title="tactic">rewrite</span></span> are combined into a
    single call to <span class="inlinecode"><span class="id" title="tactic">destruct</span></span>. 
</div>
<div class="code code-tight">

<span class="id" title="keyword">Theorem</span> <span class="id" title="variable">filter_not_empty_In'</span> : <span style='font-size:120%;'>&forall;</span><span class="id" title="variable">n</span> <span class="id" title="variable">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="variable">filter</span> (<span class="id" title="keyword">fun</span> <span class="id" title="variable">x</span> ⇒ <span class="id" title="variable">n</span> =? <span class="id" title="variable">x</span>) <span class="id" title="variable">l</span> ≠ [] →<br/>
&nbsp;&nbsp;<span class="id" title="variable">In</span> <span class="id" title="variable">n</span> <span class="id" title="variable">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">n</span> <span class="id" title="variable">l</span>. <span class="id" title="tactic">induction</span> <span class="id" title="variable">l</span> <span class="id" title="keyword">as</span> [|<span class="id" title="variable">m</span> <span class="id" title="variable">l'</span> <span class="id" title="variable">IHl'</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;l&nbsp;=&nbsp;<span class="inlinecode"></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;l&nbsp;=&nbsp;m&nbsp;::&nbsp;l'&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="variable">eqbP</span> <span class="id" title="variable">n</span> <span class="id" title="variable">m</span>) <span class="id" title="keyword">as</span> [<span class="id" title="variable">H</span> | <span class="id" title="variable">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;n&nbsp;=&nbsp;m&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">_</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="variable">H</span>. <span class="id" title="variable">left</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;n&nbsp;&lt;&gt;&nbsp;m&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="variable">H'</span>. <span class="id" title="variable">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">IHl'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="variable">H'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab271"></a><h3 class="section"> </h3>
 This small example shows how reflection gives us a small gain in
    convenience; in larger developments, using <span class="inlinecode"><span class="id" title="variable">reflect</span></span> consistently
    can often lead to noticeably shorter and clearer proof scripts.
    We'll see many more examples in later chapters and in <i>Programming
    Language Foundations</i>.

<div class="paragraph"> </div>

    The use of the <span class="inlinecode"><span class="id" title="variable">reflect</span></span> property has been popularized by
    <i>SSReflect</i>, a Coq library that has been used to formalize
    important results in mathematics, including as the 4-color theorem
    and the Feit-Thompson theorem.  The name SSReflect stands for
    <i>small-scale reflection</i>, i.e., the pervasive use of reflection to
    simplify small proof steps with boolean computations. 
</div>
</div>



</div>

</body>
</html>